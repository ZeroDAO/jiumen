import{_ as Vt}from"./sturdy-websocket-895b3f0d.js";import{C as Ht}from"./crypto-es-98998adf.js";import{n as wt}from"./nanoid-86c80500.js";import"./lodash.defaults-92f55a67.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var B=function(e,r){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},B(e,r)};function y(e,r){B(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}function H(e){return typeof e=="function"}var ot=!1,_={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var r=new Error;""+r.stack}ot=e},get useDeprecatedSynchronousErrorHandling(){return ot}};function k(e){setTimeout(function(){throw e},0)}var L={closed:!0,next:function(e){},error:function(e){if(_.useDeprecatedSynchronousErrorHandling)throw e;k(e)},complete:function(){}},tt=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function _t(e){return e!==null&&typeof e=="object"}var Lt=function(){function e(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(t,n){return n+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return e.prototype=Object.create(Error.prototype),e}(),F=Lt,T=function(){function e(r){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return e.prototype.unsubscribe=function(){var r;if(!this.closed){var t=this,n=t._parentOrParents,i=t._ctorUnsubscribe,o=t._unsubscribe,s=t._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var c=0;c<n.length;++c){var u=n[c];u.remove(this)}if(H(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(f){r=f instanceof F?st(f.errors):[f]}}if(tt(s))for(var c=-1,l=s.length;++c<l;){var a=s[c];if(_t(a))try{a.unsubscribe()}catch(p){r=r||[],p instanceof F?r=r.concat(st(p.errors)):r.push(p)}}if(r)throw new F(r)}},e.prototype.add=function(r){var t=r;if(!r)return e.EMPTY;switch(typeof r){case"function":t=new e(r);case"object":if(t===this||t.closed||typeof t.unsubscribe!="function")return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof e)){var n=t;t=new e,t._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var i=t._parentOrParents;if(i===null)t._parentOrParents=this;else if(i instanceof e){if(i===this)return t;t._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return t;var o=this._subscriptions;return o===null?this._subscriptions=[t]:o.push(t),t},e.prototype.remove=function(r){var t=this._subscriptions;if(t){var n=t.indexOf(r);n!==-1&&t.splice(n,1)}},e.EMPTY=function(r){return r.closed=!0,r}(new e),e}();function st(e){return e.reduce(function(r,t){return r.concat(t instanceof F?t.errors:t)},[])}var q=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),x=function(e){y(r,e);function r(t,n,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=L;break;case 1:if(!t){o.destination=L;break}if(typeof t=="object"){t instanceof r?(o.syncErrorThrowable=t.syncErrorThrowable,o.destination=t,t.add(o)):(o.syncErrorThrowable=!0,o.destination=new ct(o,t));break}default:o.syncErrorThrowable=!0,o.destination=new ct(o,t,n,i);break}return o}return r.prototype[q]=function(){return this},r.create=function(t,n,i){var o=new r(t,n,i);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(T),ct=function(e){y(r,e);function r(t,n,i,o){var s=e.call(this)||this;s._parentSubscriber=t;var c,u=s;return H(n)?c=n:n&&(c=n.next,i=n.error,o=n.complete,n!==L&&(u=Object.create(n),H(u.unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=c,s._error=i,s._complete=o,s}return r.prototype.next=function(t){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!_.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,t):this.__tryOrSetError(n,this._next,t)&&this.unsubscribe()}},r.prototype.error=function(t){if(!this.isStopped){var n=this._parentSubscriber,i=_.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,t),this.unsubscribe()):(this.__tryOrSetError(n,this._error,t),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=t,n.syncErrorThrown=!0):k(t),this.unsubscribe();else{if(this.unsubscribe(),i)throw t;k(t)}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return t._complete.call(t._context)};!_.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,n){try{t.call(this._context,n)}catch(i){if(this.unsubscribe(),_.useDeprecatedSynchronousErrorHandling)throw i;k(i)}},r.prototype.__tryOrSetError=function(t,n,i){if(!_.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(o){return _.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=o,t.syncErrorThrown=!0,!0):(k(o),!0)}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(x);function qt(e){for(;e;){var r=e,t=r.closed,n=r.destination,i=r.isStopped;if(t||i)return!1;n&&n instanceof x?e=n:e=null}return!0}function Wt(e,r,t){if(e){if(e instanceof x)return e;if(e[q])return e[q]()}return!e&&!r&&!t?new x(L):new x(e,r,t)}var R=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function gt(e){return e}function Yt(e){return e.length===0?gt:e.length===1?e[0]:function(t){return e.reduce(function(n,i){return i(n)},t)}}var b=function(){function e(r){this._isScalar=!1,r&&(this._subscribe=r)}return e.prototype.lift=function(r){var t=new e;return t.source=this,t.operator=r,t},e.prototype.subscribe=function(r,t,n){var i=this.operator,o=Wt(r,t,n);if(i?o.add(i.call(o,this.source)):o.add(this.source||_.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),_.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(t){_.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=t),qt(r)?r.error(t):console.warn(t)}},e.prototype.forEach=function(r,t){var n=this;return t=ut(t),new t(function(i,o){var s;s=n.subscribe(function(c){try{r(c)}catch(u){o(u),s&&s.unsubscribe()}},o,i)})},e.prototype._subscribe=function(r){var t=this.source;return t&&t.subscribe(r)},e.prototype[R]=function(){return this},e.prototype.pipe=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return r.length===0?this:Yt(r)(this)},e.prototype.toPromise=function(r){var t=this;return r=ut(r),new r(function(n,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},e.create=function(r){return new e(r)},e}();function ut(e){if(e||(e=_.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var zt=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),O=zt,Kt=function(e){y(r,e);function r(t,n){var i=e.call(this)||this;return i.subject=t,i.subscriber=n,i.closed=!1,i}return r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,n=t.observers;if(this.subject=null,!(!n||n.length===0||t.isStopped||t.closed)){var i=n.indexOf(this.subscriber);i!==-1&&n.splice(i,1)}}},r}(T),Qt=function(e){y(r,e);function r(t){var n=e.call(this,t)||this;return n.destination=t,n}return r}(x),U=function(e){y(r,e);function r(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.prototype[q]=function(){return new Qt(this)},r.prototype.lift=function(t){var n=new at(this,this);return n.operator=t,n},r.prototype.next=function(t){if(this.closed)throw new O;if(!this.isStopped)for(var n=this.observers,i=n.length,o=n.slice(),s=0;s<i;s++)o[s].next(t)},r.prototype.error=function(t){if(this.closed)throw new O;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var n=this.observers,i=n.length,o=n.slice(),s=0;s<i;s++)o[s].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new O;this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),o=0;o<n;o++)i[o].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(t){if(this.closed)throw new O;return e.prototype._trySubscribe.call(this,t)},r.prototype._subscribe=function(t){if(this.closed)throw new O;return this.hasError?(t.error(this.thrownError),T.EMPTY):this.isStopped?(t.complete(),T.EMPTY):(this.observers.push(t),new Kt(this,t))},r.prototype.asObservable=function(){var t=new b;return t.source=this,t},r.create=function(t,n){return new at(t,n)},r}(b),at=function(e){y(r,e);function r(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return r.prototype.next=function(t){var n=this.destination;n&&n.next&&n.next(t)},r.prototype.error=function(t){var n=this.destination;n&&n.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){var n=this.source;return n?this.source.subscribe(t):T.EMPTY},r}(U),Bt=function(e){y(r,e);function r(t,n){return e.call(this)||this}return r.prototype.schedule=function(t,n){return this},r}(T),Jt=function(e){y(r,e);function r(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return r.prototype.schedule=function(t,n){if(n===void 0&&(n=0),this.closed)return this;this.state=t;var i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(o,this.id,n),this},r.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),setInterval(t.flush.bind(t,this),i)},r.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},r.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(t,n){var i=!1,o=void 0;try{this.work(t)}catch(s){i=!0,o=!!s&&s||new Error(s)}if(i)return this.unsubscribe(),o},r.prototype._unsubscribe=function(){var t=this.id,n=this.scheduler,i=n.actions,o=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,o!==-1&&i.splice(o,1),t!=null&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null},r}(Bt),ht=function(){function e(r,t){t===void 0&&(t=e.now),this.SchedulerAction=r,this.now=t}return e.prototype.schedule=function(r,t,n){return t===void 0&&(t=0),new this.SchedulerAction(this,r).schedule(n,t)},e.now=function(){return Date.now()},e}(),Nt=function(e){y(r,e);function r(t,n){n===void 0&&(n=ht.now);var i=e.call(this,t,function(){return r.delegate&&r.delegate!==i?r.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return r.prototype.schedule=function(t,n,i){return n===void 0&&(n=0),r.delegate&&r.delegate!==this?r.delegate.schedule(t,n,i):e.prototype.schedule.call(this,t,n,i)},r.prototype.flush=function(t){var n=this.actions;if(this.active){n.push(t);return}var i;this.active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this.active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},r}(ht);function J(e){return e&&typeof e.schedule=="function"}var Et=function(e){return function(r){for(var t=0,n=e.length;t<n&&!r.closed;t++)r.next(e[t]);r.complete()}};function St(e,r){return new b(function(t){var n=new T,i=0;return n.add(r.schedule(function(){if(i===e.length){t.complete();return}t.next(e[i++]),t.closed||n.add(this.schedule())})),n})}function Gt(e,r){return r?St(e,r):new b(Et(e))}var Xt=new Nt(Jt),Zt=Xt;function Tt(e,r){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new te(e,r))}}var te=function(){function e(r,t){this.project=r,this.thisArg=t}return e.prototype.call=function(r,t){return t.subscribe(new ee(r,this.project,this.thisArg))},e}(),ee=function(e){y(r,e);function r(t,n,i){var o=e.call(this,t)||this;return o.project=n,o.count=0,o.thisArg=i||o,o}return r.prototype._next=function(t){var n;try{n=this.project.call(this.thisArg,t,this.count++)}catch(i){this.destination.error(i);return}this.destination.next(n)},r}(x),re=function(e){return function(r){return e.then(function(t){r.closed||(r.next(t),r.complete())},function(t){return r.error(t)}).then(null,k),r}};function ne(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var z=ne(),ie=function(e){return function(r){var t=e[z]();do{var n=void 0;try{n=t.next()}catch(i){return r.error(i),r}if(n.done){r.complete();break}if(r.next(n.value),r.closed)break}while(!0);return typeof t.return=="function"&&r.add(function(){t.return&&t.return()}),r}},oe=function(e){return function(r){var t=e[R]();if(typeof t.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(r)}},xt=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function It(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var At=function(e){if(!!e&&typeof e[R]=="function")return oe(e);if(xt(e))return Et(e);if(It(e))return re(e);if(!!e&&typeof e[z]=="function")return ie(e);var r=_t(e)?"an invalid object":"'"+e+"'",t="You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(t)};function se(e,r){return new b(function(t){var n=new T;return n.add(r.schedule(function(){var i=e[R]();n.add(i.subscribe({next:function(o){n.add(r.schedule(function(){return t.next(o)}))},error:function(o){n.add(r.schedule(function(){return t.error(o)}))},complete:function(){n.add(r.schedule(function(){return t.complete()}))}}))})),n})}function ce(e,r){return new b(function(t){var n=new T;return n.add(r.schedule(function(){return e.then(function(i){n.add(r.schedule(function(){t.next(i),n.add(r.schedule(function(){return t.complete()}))}))},function(i){n.add(r.schedule(function(){return t.error(i)}))})})),n})}function ue(e,r){if(!e)throw new Error("Iterable cannot be null");return new b(function(t){var n=new T,i;return n.add(function(){i&&typeof i.return=="function"&&i.return()}),n.add(r.schedule(function(){i=e[z](),n.add(r.schedule(function(){if(!t.closed){var o,s;try{var c=i.next();o=c.value,s=c.done}catch(u){t.error(u);return}s?t.complete():(t.next(o),this.schedule())}}))})),n})}function ae(e){return e&&typeof e[R]=="function"}function he(e){return e&&typeof e[z]=="function"}function fe(e,r){if(e!=null){if(ae(e))return se(e,r);if(It(e))return ce(e,r);if(xt(e))return St(e,r);if(he(e)||typeof e=="string")return ue(e,r)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function le(e,r){return r?fe(e,r):e instanceof b?e:new b(At(e))}var pe=function(e){y(r,e);function r(t){var n=e.call(this)||this;return n.parent=t,n}return r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(x),de=function(e){y(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}return r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(x);function be(e,r){if(!r.closed){if(e instanceof b)return e.subscribe(r);var t;try{t=At(e)(r)}catch(n){r.error(n)}return t}}function kt(e,r,t){return t===void 0&&(t=Number.POSITIVE_INFINITY),typeof r=="function"?function(n){return n.pipe(kt(function(i,o){return le(e(i,o)).pipe(Tt(function(s,c){return r(i,s,o,c)}))},t))}:(typeof r=="number"&&(t=r),function(n){return n.lift(new ye(e,t))})}var ye=function(){function e(r,t){t===void 0&&(t=Number.POSITIVE_INFINITY),this.project=r,this.concurrent=t}return e.prototype.call=function(r,t){return t.subscribe(new ve(r,this.project,this.concurrent))},e}(),ve=function(e){y(r,e);function r(t,n,i){i===void 0&&(i=Number.POSITIVE_INFINITY);var o=e.call(this,t)||this;return o.project=n,o.concurrent=i,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return r.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},r.prototype._tryNext=function(t){var n,i=this.index++;try{n=this.project(t,i)}catch(o){this.destination.error(o);return}this.active++,this._innerSub(n)},r.prototype._innerSub=function(t){var n=new pe(this),i=this.destination;i.add(n);var o=be(t,n);o!==n&&i.add(o)},r.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},r}(de);function me(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),kt(gt,e)}function Pt(e,r,t,n){return H(t)&&(n=t,t=void 0),n?Pt(e,r,t).pipe(Tt(function(i){return tt(i)?n.apply(void 0,i):n(i)})):new b(function(i){function o(s){arguments.length>1?i.next(Array.prototype.slice.call(arguments)):i.next(s)}$t(e,r,o,i,t)})}function $t(e,r,t,n,i){var o;if(ge(e)){var s=e;e.addEventListener(r,t,i),o=function(){return s.removeEventListener(r,t,i)}}else if(_e(e)){var c=e;e.on(r,t),o=function(){return c.off(r,t)}}else if(we(e)){var u=e;e.addListener(r,t),o=function(){return u.removeListener(r,t)}}else if(e&&e.length)for(var l=0,a=e.length;l<a;l++)$t(e[l],r,t,n,i);else throw new TypeError("Invalid event target");n.add(o)}function we(e){return e&&typeof e.addListener=="function"&&typeof e.removeListener=="function"}function _e(e){return e&&typeof e.on=="function"&&typeof e.off=="function"}function ge(e){return e&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"}function ft(e){return!tt(e)&&e-parseFloat(e)+1>=0}function Ee(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=Number.POSITIVE_INFINITY,n=null,i=e[e.length-1];return J(i)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(t=e.pop())):typeof i=="number"&&(t=e.pop()),n===null&&e.length===1&&e[0]instanceof b?e[0]:me(t)(Gt(e,n))}function Se(e,r,t){e===void 0&&(e=0);var n=-1;return ft(r)?n=Number(r)<1&&1||Number(r):J(r)&&(t=r),J(t)||(t=Zt),new b(function(i){var o=ft(e)?e:+e-t.now();return t.schedule(Te,o,{index:0,period:n,subscriber:i})})}function Te(e){var r=e.index,t=e.period,n=e.subscriber;if(n.next(r),!n.closed){if(t===-1)return n.complete();e.index=r+1,this.schedule(e,t)}}const Ct={ethereum:{1:"main",5:"goerli",100:"xdai",137:"matic-main",80001:"matic-mumbai"}},xe=[2,3,4,42,56,250],Mt={points:150,duration:1},lt=1e4;function d(e){const{name:r,value:t,type:n,optional:i,customValidation:o}=e;if(!i&&typeof t>"u")throw new Error(`"${r}" is required`);if(typeof t<"u"&&(n==="array"?Array.isArray(n):typeof t!==n))throw new Error(`"${r}" must be of type: ${n}, received type: ${typeof t} from value: ${t}`);if(typeof t<"u"&&o&&!o(t))throw new Error(`"${t}" is not a valid "${r}"`)}function Ie(e){d({name:"sdk options",value:e,type:"object"});const{dappId:r,system:t,name:n,appVersion:i,networkId:o,transactionHandlers:s,apiUrl:c,ws:u,onopen:l,ondown:a,onreopen:f,onerror:p,onclose:$,...I}=e;ke(I,["dappId","system","name","appVersion","networkId","transactionHandlers","apiUrl","ws","onopen","ondown","onreopen","onerror","onclose"],"Initialization Options"),d({name:"dappId",value:r,type:"string",optional:!0}),d({name:"system",value:t,type:"string",optional:!0,customValidation:Ae}),d({name:"name",value:n,type:"string",optional:!0}),d({name:"appVersion",value:i,type:"string",optional:!0}),d({name:"networkId",value:o,type:"number"}),xe.includes(o)&&console.error(`Blocknative SDK: Network with ID: ${o} has been deprecated and you will no longer receive transaction events on this network.`),d({name:"transactionHandler",value:s,type:"array",optional:!0}),s&&s.forEach(A=>d({name:"transactionHandler",value:A,type:"function"})),d({name:"apiUrl",value:c,type:"string",optional:!0}),d({name:"ws",value:u,type:"function",optional:!0}),d({name:"onopen",value:l,type:"function",optional:!0}),d({name:"ondown",value:a,type:"function",optional:!0}),d({name:"onreopen",value:f,type:"function",optional:!0}),d({name:"onerror",value:p,type:"function",optional:!0}),d({name:"onclose",value:$,type:"function",optional:!0})}function Ae(e){return!!Ct[e]}function ke(e,r,t){const n=Object.keys(e);if(n.length>0)throw new Error(`${n[0]} is not a valid parameter for ${t}, must be one of the following valid parameters: ${r.join(", ")}`)}function et(){return{listeners:{},on:function(e,r){switch(e){case"txSent":case"txPool":case"txConfirmed":case"txSpeedUp":case"txCancel":case"txFailed":case"txDropped":case"txRequest":case"nsfFail":case"txRepeat":case"txAwaitingApproval":case"txConfirmReminder":case"txSendFail":case"txError":case"txUnderPriced":case"txPoolSimulation":case"all":break;default:throw new Error(`${e} is not a valid event code, for a list of valid event codes see: https://docs.blocknative.com/notify-sdk#event-codes`)}if(typeof r!="function")throw new Error("Listener must be a function");this.listeners[e]=r},off:function(e){delete this.listeners[e]},emit:function(e){if(this.listeners[e.eventCode])return this.listeners[e.eventCode](e);if(this.listeners.all)return this.listeners.all(e)}}}function Ot(e,r){return Ct[e][r]}function Pe(e){switch(e){case"txRequest":case"nsfFail":case"txRepeat":case"txAwaitingApproval":case"txConfirmReminder":case"txSendFail":case"txError":case"txUnderPriced":case"txSent":return!0;default:return!1}}function $e(e){return e.reverse()[0]}function Ce(e,r){switch(e){case"ethereum":return r.length===42;case"bitcoin":return r.length!==64;default:return!1}}function Me(e,r){switch(e){case"ethereum":return r.length===66;case"bitcoin":return r.length===64;default:return!1}}function N(e){return new Promise(r=>{setTimeout(r,e)})}const Oe=(e,r)=>r===void 0?"undefined":r;function Ut(){if(typeof window<"u"&&"localStorage"in window){const r="__testLocalStorage";try{return window.localStorage.setItem(r,"1"),window.localStorage.removeItem(r),!0}catch{return!1}}return!1}function Ue(e,r){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");const t=Date.now(),n=et(),i="txSent";this.watchedTransactions.push({hash:e,emitter:n});const s={...this._system==="ethereum"?{hash:e}:{txid:e},id:r||e,startTime:t,status:"sent"},c={...s,eventCode:i};this._sendMessage({eventCode:i,categoryCode:"activeTransaction",transaction:s});const u={details:c,emitter:n};function l(){const a=n.emit(c);this._transactionHandlers.forEach(f=>f({transaction:c,emitterResult:a}))}return setTimeout(l.bind(this),5),u}function De(e){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");e=this._system==="ethereum"?e.toLowerCase():e;const r=et(),t="watch",n=this.watchedAccounts.find(i=>i.address===e);return n?n.emitters.push(r):this.watchedAccounts.push({address:e,emitters:[r]}),this._sendMessage({eventCode:t,categoryCode:"accountAddress",account:{address:e}}),{emitter:r,details:{address:e}}}function Re(e){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");this._sendMessage(e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var G=function(e,r){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},G(e,r)};function v(e,r){G(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}function X(e){return typeof e=="function"}var pt=!1,S={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var r=new Error;""+r.stack}pt=e},get useDeprecatedSynchronousErrorHandling(){return pt}};function P(e){setTimeout(function(){throw e},0)}var W={closed:!0,next:function(e){},error:function(e){if(S.useDeprecatedSynchronousErrorHandling)throw e;P(e)},complete:function(){}},je=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function Dt(e){return e!==null&&typeof e=="object"}var Fe=function(){function e(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(t,n){return n+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return e.prototype=Object.create(Error.prototype),e}(),V=Fe,rt=function(){function e(r){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return e.prototype.unsubscribe=function(){var r;if(!this.closed){var t=this,n=t._parentOrParents,i=t._ctorUnsubscribe,o=t._unsubscribe,s=t._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var c=0;c<n.length;++c){var u=n[c];u.remove(this)}if(X(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(f){r=f instanceof V?dt(f.errors):[f]}}if(je(s))for(var c=-1,l=s.length;++c<l;){var a=s[c];if(Dt(a))try{a.unsubscribe()}catch(p){r=r||[],p instanceof V?r=r.concat(dt(p.errors)):r.push(p)}}if(r)throw new V(r)}},e.prototype.add=function(r){var t=r;if(!r)return e.EMPTY;switch(typeof r){case"function":t=new e(r);case"object":if(t===this||t.closed||typeof t.unsubscribe!="function")return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof e)){var n=t;t=new e,t._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var i=t._parentOrParents;if(i===null)t._parentOrParents=this;else if(i instanceof e){if(i===this)return t;t._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return t;var o=this._subscriptions;return o===null?this._subscriptions=[t]:o.push(t),t},e.prototype.remove=function(r){var t=this._subscriptions;if(t){var n=t.indexOf(r);n!==-1&&t.splice(n,1)}},e.EMPTY=function(r){return r.closed=!0,r}(new e),e}();function dt(e){return e.reduce(function(r,t){return r.concat(t instanceof V?t.errors:t)},[])}var Z=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),g=function(e){v(r,e);function r(t,n,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=W;break;case 1:if(!t){o.destination=W;break}if(typeof t=="object"){t instanceof r?(o.syncErrorThrowable=t.syncErrorThrowable,o.destination=t,t.add(o)):(o.syncErrorThrowable=!0,o.destination=new bt(o,t));break}default:o.syncErrorThrowable=!0,o.destination=new bt(o,t,n,i);break}return o}return r.prototype[Z]=function(){return this},r.create=function(t,n,i){var o=new r(t,n,i);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(rt),bt=function(e){v(r,e);function r(t,n,i,o){var s=e.call(this)||this;s._parentSubscriber=t;var c,u=s;return X(n)?c=n:n&&(c=n.next,i=n.error,o=n.complete,n!==W&&(u=Object.create(n),X(u.unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=c,s._error=i,s._complete=o,s}return r.prototype.next=function(t){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!S.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,t):this.__tryOrSetError(n,this._next,t)&&this.unsubscribe()}},r.prototype.error=function(t){if(!this.isStopped){var n=this._parentSubscriber,i=S.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,t),this.unsubscribe()):(this.__tryOrSetError(n,this._error,t),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=t,n.syncErrorThrown=!0):P(t),this.unsubscribe();else{if(this.unsubscribe(),i)throw t;P(t)}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return t._complete.call(t._context)};!S.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,n){try{t.call(this._context,n)}catch(i){if(this.unsubscribe(),S.useDeprecatedSynchronousErrorHandling)throw i;P(i)}},r.prototype.__tryOrSetError=function(t,n,i){if(!S.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(o){return S.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=o,t.syncErrorThrown=!0,!0):(P(o),!0)}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(g);function Ve(e){for(;e;){var r=e,t=r.closed,n=r.destination,i=r.isStopped;if(t||i)return!1;n&&n instanceof g?e=n:e=null}return!0}function He(e,r,t){if(e){if(e instanceof g)return e;if(e[Z])return e[Z]()}return!e&&!r&&!t?new g(W):new g(e,r,t)}var nt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Le(e){return e}function qe(e){return e.length===0?Le:e.length===1?e[0]:function(t){return e.reduce(function(n,i){return i(n)},t)}}var D=function(){function e(r){this._isScalar=!1,r&&(this._subscribe=r)}return e.prototype.lift=function(r){var t=new e;return t.source=this,t.operator=r,t},e.prototype.subscribe=function(r,t,n){var i=this.operator,o=He(r,t,n);if(i?o.add(i.call(o,this.source)):o.add(this.source||S.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),S.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(t){S.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=t),Ve(r)?r.error(t):console.warn(t)}},e.prototype.forEach=function(r,t){var n=this;return t=yt(t),new t(function(i,o){var s;s=n.subscribe(function(c){try{r(c)}catch(u){o(u),s&&s.unsubscribe()}},o,i)})},e.prototype._subscribe=function(r){var t=this.source;return t&&t.subscribe(r)},e.prototype[nt]=function(){return this},e.prototype.pipe=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return r.length===0?this:qe(r)(this)},e.prototype.toPromise=function(r){var t=this;return r=yt(r),new r(function(n,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},e.create=function(r){return new e(r)},e}();function yt(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var We=function(e){return function(r){for(var t=0,n=e.length;t<n&&!r.closed;t++)r.next(e[t]);r.complete()}},Ye=function(e){return function(r){return e.then(function(t){r.closed||(r.next(t),r.complete())},function(t){return r.error(t)}).then(null,P),r}};function ze(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Rt=ze(),Ke=function(e){return function(r){var t=e[Rt]();do{var n=void 0;try{n=t.next()}catch(i){return r.error(i),r}if(n.done){r.complete();break}if(r.next(n.value),r.closed)break}while(!0);return typeof t.return=="function"&&r.add(function(){t.return&&t.return()}),r}},Qe=function(e){return function(r){var t=e[nt]();if(typeof t.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(r)}},Be=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Je(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var Ne=function(e){if(!!e&&typeof e[nt]=="function")return Qe(e);if(Be(e))return We(e);if(Je(e))return Ye(e);if(!!e&&typeof e[Rt]=="function")return Ke(e);var r=Dt(e)?"an invalid object":"'"+e+"'",t="You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(t)},Ge=function(e){v(r,e);function r(t){var n=e.call(this)||this;return n.parent=t,n}return r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(g),Xe=function(e){v(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}return r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(g);function Ze(e,r){if(!r.closed)return e instanceof D?e.subscribe(r):Ne(e)(r)}var tr=function(e){v(r,e);function r(t,n){return e.call(this)||this}return r.prototype.schedule=function(t,n){return this},r}(rt),er=function(e){v(r,e);function r(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return r.prototype.schedule=function(t,n){if(n===void 0&&(n=0),this.closed)return this;this.state=t;var i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(o,this.id,n),this},r.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),setInterval(t.flush.bind(t,this),i)},r.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},r.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(t,n){var i=!1,o=void 0;try{this.work(t)}catch(s){i=!0,o=!!s&&s||new Error(s)}if(i)return this.unsubscribe(),o},r.prototype._unsubscribe=function(){var t=this.id,n=this.scheduler,i=n.actions,o=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,o!==-1&&i.splice(o,1),t!=null&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null},r}(tr),vt=function(){function e(r,t){t===void 0&&(t=e.now),this.SchedulerAction=r,this.now=t}return e.prototype.schedule=function(r,t,n){return t===void 0&&(t=0),new this.SchedulerAction(this,r).schedule(n,t)},e.now=function(){return Date.now()},e}(),rr=function(e){v(r,e);function r(t,n){n===void 0&&(n=vt.now);var i=e.call(this,t,function(){return r.delegate&&r.delegate!==i?r.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return r.prototype.schedule=function(t,n,i){return n===void 0&&(n=0),r.delegate&&r.delegate!==this?r.delegate.schedule(t,n,i):e.prototype.schedule.call(this,t,n,i)},r.prototype.flush=function(t){var n=this.actions;if(this.active){n.push(t);return}var i;this.active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this.active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},r}(vt),nr=new rr(er),jt=nr;function ir(e){return e instanceof Date&&!isNaN(+e)}var or=new D(function(e){return e.complete()});function sr(e){return e?cr(e):or}function cr(e){return new D(function(r){return e.schedule(function(){return r.complete()})})}function ur(e,r){return r?new D(function(t){return r.schedule(ar,0,{error:e,subscriber:t})}):new D(function(t){return t.error(e)})}function ar(e){var r=e.error,t=e.subscriber;t.error(r)}var hr=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),fr=hr;function K(e,r){return function(n){return n.lift(new lr(e,r))}}var lr=function(){function e(r,t){this.predicate=r,this.thisArg=t}return e.prototype.call=function(r,t){return t.subscribe(new pr(r,this.predicate,this.thisArg))},e}(),pr=function(e){v(r,e);function r(t,n,i){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=i,o.count=0,o}return r.prototype._next=function(t){var n;try{n=this.predicate.call(this.thisArg,t,this.count++)}catch(i){this.destination.error(i);return}n&&this.destination.next(t)},r}(g);function Q(e){return function(r){return e===0?sr():r.lift(new dr(e))}}var dr=function(){function e(r){if(this.total=r,this.total<0)throw new fr}return e.prototype.call=function(r,t){return t.subscribe(new br(r,this.total))},e}(),br=function(e){v(r,e);function r(t,n){var i=e.call(this,t)||this;return i.total=n,i.count=0,i}return r.prototype._next=function(t){var n=this.total,i=++this.count;i<=n&&(this.destination.next(t),i===n&&(this.destination.complete(),this.unsubscribe()))},r}(g);function mt(e){return function(r){return r.lift(new yr(e))}}var yr=function(){function e(r){this.callback=r}return e.prototype.call=function(r,t){return t.subscribe(new vr(r,this.callback))},e}(),vr=function(e){v(r,e);function r(t,n){var i=e.call(this,t)||this;return i.add(new rt(n)),i}return r}(g);function mr(e,r){return r===void 0&&(r=!1),function(t){return t.lift(new wr(e,r))}}var wr=function(){function e(r,t){this.predicate=r,this.inclusive=t}return e.prototype.call=function(r,t){return t.subscribe(new _r(r,this.predicate,this.inclusive))},e}(),_r=function(e){v(r,e);function r(t,n,i){var o=e.call(this,t)||this;return o.predicate=n,o.inclusive=i,o.index=0,o}return r.prototype._next=function(t){var n=this.destination,i;try{i=this.predicate(t,this.index++)}catch(o){n.error(o);return}this.nextOrComplete(t,i)},r.prototype.nextOrComplete=function(t,n){var i=this.destination;Boolean(n)?i.next(t):(this.inclusive&&i.next(t),i.complete())},r}(g),gr=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Er=gr;function Sr(e,r,t){return t===void 0&&(t=jt),function(n){var i=ir(e),o=i?+e-t.now():Math.abs(e);return n.lift(new Tr(o,i,r,t))}}var Tr=function(){function e(r,t,n,i){this.waitFor=r,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=i}return e.prototype.call=function(r,t){return t.subscribe(new xr(r,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),xr=function(e){v(r,e);function r(t,n,i,o,s){var c=e.call(this,t)||this;return c.absoluteTimeout=n,c.waitFor=i,c.withObservable=o,c.scheduler=s,c.scheduleTimeout(),c}return r.dispatchTimeout=function(t){var n=t.withObservable;t._unsubscribeAndRecycle(),t.add(Ze(n,new Ge(t)))},r.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},r.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},r}(Xe);function Ir(e,r){return r===void 0&&(r=jt),Sr(e,ur(new Er),r)}const Y=new U;function Ar(e,r,t){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");const n=wt();return this._sendMessage({categoryCode:"simulate",eventCode:"txSimulation",eventId:n,transaction:t}),new Promise((i,o)=>{Y.pipe(K(({eventId:s})=>s===n),Q(1)).subscribe({next:({transaction:s})=>i(s),error:({error:s})=>o(s.message)})})}function kr(e){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");const r=wt();return this._sendMessage({categoryCode:"simulate",eventCode:"txSimulation",eventId:r,transaction:e}),new Promise((t,n)=>{Y.pipe(K(({eventId:i})=>i===r),Q(1)).subscribe({next:({transaction:i})=>t(i),error:({error:i})=>n(i.message)})})}function Pr(e){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");const r=Ce(this._system,e),t=Me(this._system,e);if(r){const n=this._system==="ethereum"?e.toLowerCase():e;this.watchedAccounts=this.watchedAccounts.filter(i=>i.address!==n),this.configurations.delete(n),this._sendMessage({categoryCode:"accountAddress",eventCode:"unwatch",account:{address:n}})}else if(t){this.watchedTransactions=this.watchedTransactions.filter(o=>o.hash!==e);const i={...this._system==="ethereum"?{hash:e}:{txid:e},id:e,status:"unsubscribed"};this._sendMessage({categoryCode:"activeTransaction",eventCode:"unwatch",transaction:i})}else throw new Error(`Error trying to unsubscribe ${e}: not a valid address or transaction id/hash`)}function $r(e){if(this._destroyed)throw new Error("The WebSocket instance has been destroyed, re-initialize to continue making requests.");const r=this._system==="ethereum"?e.scope.toLowerCase():e.scope,t=this.configurations.get(r);t&&t.subscription&&t.subscription.next();const n=new U,i=e.watchAddress?{emitter:et()}:{};return this.configurations.set(r,{...e,...i,subscription:n}),this._sendMessage({categoryCode:"configs",eventCode:"put",config:e}),new Promise((o,s)=>{n.pipe(Q(1),Ir(5e3)).subscribe({next:()=>o({...i,details:{config:e}}),error:c=>{const u=c.message==="Timeout has occurred"?`Configuration with scope: ${e.scope} has been sent to the Blocknative server, but has not received a reply within 5 seconds.`:c.message;this._onerror?(this._onerror({message:u}),o(`Error: ${u}`)):s(u)}})})}function Cr(e){const{id:r,chainId:t,type:n}=e;if(!Ot("ethereum",parseInt(t,16)))throw new Error(`chainId: ${t} is an unsupported network`);this.connections[t]||(this.connections[t]=new this.Blocknative({system:"ethereum",networkId:parseInt(t,16),dappId:this.apiKey,ws:this.ws,apiUrl:this.apiUrl,transactionHandlers:[({transaction:o})=>{this.onTransaction$.next(o)}],onerror:o=>this.errors$.next(o)}));const i=this.connections[t];if(n==="account"){const{filters:o=[],abi:s}=e;return i.configuration({scope:r,filters:o,...s?{abi:s}:{},watchAddress:!0}),this.transactions$.pipe(K(({watchedAddress:c})=>c===r),mt(()=>{this.unsubscribe({id:r,chainId:t})}))}else{const{emitter:o}=i.transaction(r);return Pt(o,"all").pipe(mr(({status:s})=>s!=="confirmed"&&s!=="failed"&&s!=="dropped",!0),mt(()=>{this.unsubscribe({id:r,chainId:t})}))}}function Mr(e){const{id:r,chainId:t,timeout:n=0}=e,i=Se(n),o=this.transactions$.pipe(K(({hash:s,watchedAddress:c})=>s===r||c===r));Ee(o,i).pipe(Q(1)).subscribe(s=>{typeof s=="number"?Object.entries(this.connections).filter(([u,l])=>l!==null).forEach(([u,l])=>{t&&u!==t||(l.unsubscribe(r),!l.watchedAccounts.length&&!l.watchedTransactions.length&&!l.configurations.size&&(l.destroy(),this.connections[u]=null))}):this.unsubscribe(e)})}class Or{constructor(r,t){const{ws:n}=r,{apiKey:i}=r,{apiUrl:o}=r;this.apiKey=i,this.apiUrl=o,this.ws=n,this.connections={},this.onTransaction$=new U,this.transactions$=this.onTransaction$.asObservable(),this.errors$=new U,this.Blocknative=t,this.subscribe=Cr.bind(this),this.unsubscribe=Mr.bind(this)}}var Ur="4.6.5";function Dr(e){if(this._queuedMessages.length>lt)throw new Error(`Queue limit of ${lt} messages has been reached.`);this._queuedMessages.push(it.bind(this)(e)),this._processingQueue||this._processQueue()}async function Rr(){for(this._processingQueue=!0,this._connected||await Fr.bind(this)();this._queuedMessages.length>0;){await N(1),this._waitToRetry!==null&&(await this._waitToRetry,this._waitToRetry=null);const e=this._queuedMessages.shift(),r=this._limitRules.duration/this._limitRules.points*1e3;await N(r),this._socket.send(e)}this._processingQueue=!1,this._limitRules=Mt}function jr(e){const{status:r,reason:t,event:n,connectionId:i,serverVersion:o,retryMs:s,limitRules:c,blockedMsg:u,dispatchTimestamp:l}=JSON.parse(e.data);if(i&&(Ut()&&window.localStorage.setItem(this._storageKey,i),this._connectionId=i),r==="error"){if(t.includes("ratelimit")&&!t.match(/IP (PendingSimulation|Notification) ratelimit reached/)){this._waitToRetry=N(s),this._limitRules=c,u&&this._queuedMessages.unshift(u);return}if(t.includes("upgrade your plan"))if(this._onerror){this._onerror({message:t});return}else throw new Error(t);if(t.includes("not a valid API key"))if(this._onerror){this._onerror({message:t});return}else throw new Error(t);if(t.includes("network not supported"))if(this._onerror){this._onerror({message:t});return}else throw new Error(t);if(t.includes("maximum allowed amount"))if(this._onerror){this._onerror({message:t});return}else throw new Error(t);if(t.includes("invalid txid")){const a=`${n.transaction.txid} is an invalid txid`;if(this._onerror){this._onerror({message:a,transaction:n.transaction.txid});return}else throw new Error(a)}if(t.includes("invalid hash")){const a=`${n.transaction.hash} is an invalid transaction hash`;if(this._onerror){this._onerror({message:a,transaction:n.transaction.hash});return}else throw new Error(a)}if(t.includes("invalid address")){const a=`${n.account.address} is an invalid address`;if(this._onerror){this._onerror({message:a,account:n.account.address});return}else throw new Error(a)}if(t.includes("not a valid Bitcoin"))if(this._onerror){this._onerror({message:t,account:n.account.address});return}else throw new Error(t);if(t.includes("not a valid Ethereum"))if(this._onerror){this._onerror({message:t,account:n.account.address});return}else throw new Error(t);if(n&&n.categoryCode==="simulate"){Y.error({eventId:n.eventId,error:{message:t}});return}if(n&&n.config){const a=this.configurations.get(n.config.scope);a&&a.subscription&&a.subscription.error({message:t});return}if(this._onerror){this._onerror({message:t});return}else throw new Error(t)}if(n&&n.config){const a=this._system==="ethereum"?n.config.scope.toLowerCase():n.config.scope,f=this.configurations.get(a);f&&f.subscription&&f.subscription.next()}if(n&&n.transaction){const{eventId:a,transaction:f,eventCode:p,contractCall:$,timeStamp:I,blockchain:{system:A,network:E}}=n,h=this._system==="ethereum"?{...f,serverVersion:o,eventCode:p,timeStamp:I,dispatchTimestamp:l,system:A,network:E,contractCall:$}:{...f,serverVersion:o,eventCode:p,timeStamp:I,dispatchTimestamp:l,system:A,network:E};if(Pe(p)||f.status==="unsubscribed")return;if(h.originalHash&&(h.replaceHash=h.hash,h.hash=h.originalHash,delete h.originalHash),p==="txSpeedUp"&&h.status!=="speedup"&&(h.status="speedup"),p==="txCancel"&&h.status!=="cancel"&&(h.status="cancel"),(p==="txSpeedUp"||p==="txCancel")&&(this.watchedTransactions=this.watchedTransactions.map(m=>(m.hash===h.replaceHash&&(m.hash=f.hash||f.txid),m))),n&&n.categoryCode==="simulate"){h.contractCall=n.transaction.contractCall,delete h.dispatchTimestamp,Y.next({eventId:a,transaction:h});return}const C=f.watchedAddress&&this._system==="ethereum"?f.watchedAddress.toLowerCase():f.watchedAddress;if(C){const m=this.watchedAccounts.find(M=>M.address===C),j=m?$e(m.emitters.map(M=>M.emit(h))):!1,w=this.configurations.get(C),Ft=w&&w.emitter&&w.emitter.emit(h)||j;this._transactionHandlers.forEach(M=>M({transaction:h,emitterResult:Ft}))}else{const m=this.watchedTransactions.find(w=>w.hash===h.hash||h.txid),j=m&&m.emitter.emit(h);this._transactionHandlers.forEach(w=>w({transaction:h,emitterResult:j})),(h.status==="speedup"||h.status==="cancel")&&(this.watchedTransactions=this.watchedTransactions.map(w=>w.hash===h.hash||h.txid?{...w,hash:h.replaceHash}:w))}}}function it(e){return JSON.stringify({timeStamp:new Date().toISOString(),dappId:this._dappId,version:Ur,appName:this._appName,appVersion:this._appVersion,blockchain:{system:this._system,network:Ot(this._system,this._networkId)||"local"},...e},e.categoryCode==="configs"?Oe:void 0)}function Fr(){return new Promise(e=>{const r=setInterval(()=>{this._connected&&(setTimeout(e,100),clearInterval(r))})})}const Vr="unknown",Hr="unknown",Lr="ethereum";class Jr{constructor(r){Ie(r);const{system:t=Lr,name:n=Vr,appVersion:i=Hr,networkId:o,transactionHandlers:s=[],ws:c,onopen:u,ondown:l,onreopen:a,onerror:f,onclose:p}=r,{apiUrl:$}=r,{dappId:I}=r,A={connectTimeout:1e4},E=new Vt($||"wss://api.blocknative.com/v0",c?{wsConstructor:c,...A}:{...A});E.onopen=qr.bind(this,u),E.ondown=Wr.bind(this,l),E.onreopen=Yr.bind(this,a),E.onmessage=jr.bind(this),E.onerror=m=>f&&f({message:"There was a WebSocket error",error:m}),E.onclose=()=>{this._pingTimeout&&clearInterval(this._pingTimeout),p&&p()};const h=Ht.SHA1(`${I} - ${n}`).toString(),C=Ut()&&window.localStorage.getItem(h);this._storageKey=h,this._connectionId=C||void 0,this._dappId=I,this._system=t,this._networkId=o,this._appName=n,this._appVersion=i,this._transactionHandlers=s,this._socket=E,this._connected=!1,this._sendMessage=Dr.bind(this),this._pingTimeout=void 0,this._destroyed=!1,this._onerror=f,this._queuedMessages=[],this._limitRules=Mt,this._waitToRetry=null,this._processingQueue=!1,this._processQueue=Rr.bind(this),this._socket.ws.on&&(this._heartbeat=()=>{this._pingTimeout&&clearTimeout(this._pingTimeout),this._pingTimeout=setTimeout(()=>{this._socket.ws.terminate()},3e4+1e3)},this._socket.ws.on("ping",()=>{this._heartbeat&&this._heartbeat()})),this.watchedTransactions=[],this.watchedAccounts=[],this.configurations=new Map,this.transaction=Ue.bind(this),this.account=De.bind(this),this.event=Re.bind(this),this.simulate=Ar.bind(this),this.multiSim=kr.bind(this),this.unsubscribe=Pr.bind(this),this.configuration=$r.bind(this),this.destroy=()=>{this._socket.close(),this._destroyed=!0,this._socket.onclose()}}static multichain(r){return new Or(r,this)}}function qr(e){this._connected=!0;const r={categoryCode:"initialize",eventCode:"checkDappId",connectionId:this._connectionId};this._socket.send(it.bind(this)(r)),this._heartbeat&&this._heartbeat(),e&&e()}function Wr(e,r){this._connected=!1,e&&e(r),this._pingTimeout&&clearTimeout(this._pingTimeout)}async function Yr(e){this._connected=!0;const r={categoryCode:"initialize",eventCode:"checkDappId",connectionId:this._connectionId};this._socket.send(it.bind(this)(r));const t=Array.from(this.configurations.values()),n=this.configurations.get("global");if(n)try{const{emitter:o,subscription:s,...c}=n;await this.configuration(c)}catch(o){console.warn("Error re-sending global configuration upon reconnection:",o)}t.filter(({scope:o})=>o!=="global").forEach(o=>{const{emitter:s,subscription:c,...u}=o;this._sendMessage({categoryCode:"configs",eventCode:"put",config:u})}),this.watchedAccounts.forEach(o=>{this._sendMessage({eventCode:"accountAddress",categoryCode:"watch",account:{address:o.address}})}),e&&e(),this._socket.ws&&this._socket.ws.on&&(this._socket.ws.on("ping",()=>{this._heartbeat&&this._heartbeat()}),this._heartbeat())}export{Jr as default};

function f(){}function q(n){return n()}function m(n){n.forEach(q)}function w(n){return typeof n=="function"}function z(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}function _(n,...t){if(n==null)return f;const r=n.subscribe(...t);return r.unsubscribe?()=>r.unsubscribe():r}function x(n){let t;return _(n,r=>t=r)(),t}Promise.resolve();const o=[];function A(n,t){return{subscribe:j(n,t).subscribe}}function j(n,t=f){let r;const s=new Set;function b(u){if(z(n,u)&&(n=u,r)){const i=!o.length;for(const e of s)e[1](),o.push(e,n);if(i){for(let e=0;e<o.length;e+=2)o[e][0](o[e+1]);o.length=0}}}function a(u){b(u(n))}function l(u,i=f){const e=[u,i];return s.add(e),s.size===1&&(r=t(b)||f),u(n),()=>{s.delete(e),s.size===0&&(r(),r=null)}}return{set:b,update:a,subscribe:l}}function E(n,t,r){const s=!Array.isArray(n),b=s?[n]:n,a=t.length<2;return A(r,l=>{let u=!1;const i=[];let e=0,p=f;const g=()=>{if(e)return;p();const c=t(s?i[0]:i,l);a?l(c):p=w(c)?c:f},y=b.map((c,d)=>_(c,h=>{i[d]=h,e&=~(1<<d),u&&g()},()=>{e|=1<<d}));return u=!0,g(),function(){m(y),p()}})}export{E as d,x as g,j as w};

import{l as a}from"./lodash.defaults-92f55a67.js";var l={};Object.defineProperty(l,"__esModule",{value:!0});var u=a,h="Provided shouldReconnect() returned false. Closing permanently.",f="Provided shouldReconnect() resolved to false. Closing permanently.",p=function(){function t(e,n,o){if(this.url=e,this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.ondown=null,this.onreopen=null,this.CONNECTING=t.CONNECTING,this.OPEN=t.OPEN,this.CLOSING=t.CLOSING,this.CLOSED=t.CLOSED,this.hasBeenOpened=!1,this.isClosed=!1,this.messageBuffer=[],this.nextRetryTime=0,this.reconnectCount=0,this.lastKnownExtensions="",this.lastKnownProtocol="",this.listeners={},n==null||typeof n=="string"||Array.isArray(n)?this.protocols=n:o=n,this.options=u({},o,t.DEFAULT_OPTIONS),!this.options.wsConstructor)if(typeof WebSocket<"u")this.options.wsConstructor=WebSocket;else throw new Error("WebSocket not present in global scope and no wsConstructor option was provided.");this.openNewWebSocket()}return Object.defineProperty(t.prototype,"binaryType",{get:function(){return this.binaryTypeInternal||"blob"},set:function(e){this.binaryTypeInternal=e,this.ws&&(this.ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this.ws?this.ws.bufferedAmount:0,n=!1;return this.messageBuffer.forEach(function(o){var s=d(o);s!=null?e+=s:n=!0}),n&&this.debugLog("Some buffered data had unknown length. bufferedAmount() return value may be below the correct amount."),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this.ws?this.ws.extensions:this.lastKnownExtensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this.ws?this.ws.protocol:this.lastKnownProtocol},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this.isClosed?t.CLOSED:t.OPEN},enumerable:!0,configurable:!0}),t.prototype.close=function(e,n){this.ws&&this.ws.close(e,n),this.shutdown(),this.debugLog("WebSocket permanently closed by client.")},t.prototype.send=function(e){this.ws&&this.ws.readyState===this.OPEN?this.ws.send(e):this.messageBuffer.push(e)},t.prototype.addEventListener=function(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(n)},t.prototype.dispatchEvent=function(e){return this.dispatchEventOfType(e.type,e)},t.prototype.removeEventListener=function(e,n){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(function(o){return o!==n}))},t.prototype.openNewWebSocket=function(){var e=this;if(!this.isClosed){var n=this.options,o=n.connectTimeout,s=n.wsConstructor;this.debugLog("Opening new WebSocket to "+this.url+".");var r=new s(this.url,this.protocols);r.onclose=function(i){return e.handleClose(i)},r.onerror=function(i){return e.handleError(i)},r.onmessage=function(i){return e.handleMessage(i)},r.onopen=function(i){return e.handleOpen(i)},this.connectTimeoutId=setTimeout(function(){e.clearConnectTimeout(),r.close()},o),this.ws=r}},t.prototype.handleOpen=function(e){var n=this;if(!(!this.ws||this.isClosed)){var o=this.options.allClearResetTime;this.debugLog("WebSocket opened."),this.binaryTypeInternal!=null?this.ws.binaryType=this.binaryTypeInternal:this.binaryTypeInternal=this.ws.binaryType,this.clearConnectTimeout(),this.hasBeenOpened?this.dispatchEventOfType("reopen",e):(this.dispatchEventOfType("open",e),this.hasBeenOpened=!0),this.messageBuffer.forEach(function(s){return n.send(s)}),this.messageBuffer=[],this.allClearTimeoutId=setTimeout(function(){n.clearAllClearTimeout(),n.nextRetryTime=0,n.reconnectCount=0;var s=o/1e3|0;n.debugLog("WebSocket remained open for "+s+" seconds. Resetting retry time and count.")},o)}},t.prototype.handleMessage=function(e){this.isClosed||this.dispatchEventOfType("message",e)},t.prototype.handleClose=function(e){var n=this;if(!this.isClosed){var o=this.options,s=o.maxReconnectAttempts,r=o.shouldReconnect;if(this.clearConnectTimeout(),this.clearAllClearTimeout(),this.ws&&(this.lastKnownExtensions=this.ws.extensions,this.lastKnownProtocol=this.ws.protocol,this.ws=void 0),this.dispatchEventOfType("down",e),this.reconnectCount>=s){this.stopReconnecting(e,this.getTooManyFailedReconnectsMessage());return}var i=r(e);typeof i=="boolean"?this.handleWillReconnect(i,e,h):i.then(function(c){n.isClosed||n.handleWillReconnect(c,e,f)})}},t.prototype.handleError=function(e){this.dispatchEventOfType("error",e),this.debugLog("WebSocket encountered an error.")},t.prototype.handleWillReconnect=function(e,n,o){e?this.reconnect():this.stopReconnecting(n,o)},t.prototype.reconnect=function(){var e=this,n=this.options,o=n.minReconnectDelay,s=n.maxReconnectDelay,r=n.reconnectBackoffFactor;this.reconnectCount++;var i=this.nextRetryTime;this.nextRetryTime=Math.max(o,Math.min(this.nextRetryTime*r,s)),setTimeout(function(){return e.openNewWebSocket()},i);var c=i/1e3|0;this.debugLog("WebSocket was closed. Re-opening in "+c+" seconds.")},t.prototype.stopReconnecting=function(e,n){this.debugLog(n),this.shutdown(),this.dispatchEventOfType("close",e)},t.prototype.shutdown=function(){this.isClosed=!0,this.clearAllTimeouts(),this.messageBuffer=[]},t.prototype.clearAllTimeouts=function(){this.clearConnectTimeout(),this.clearAllClearTimeout()},t.prototype.clearConnectTimeout=function(){this.connectTimeoutId!=null&&(clearTimeout(this.connectTimeoutId),this.connectTimeoutId=void 0)},t.prototype.clearAllClearTimeout=function(){this.allClearTimeoutId!=null&&(clearTimeout(this.allClearTimeoutId),this.allClearTimeoutId=void 0)},t.prototype.dispatchEventOfType=function(e,n){var o=this;switch(e){case"close":this.onclose&&this.onclose(n);break;case"error":this.onerror&&this.onerror(n);break;case"message":this.onmessage&&this.onmessage(n);break;case"open":this.onopen&&this.onopen(n);break;case"down":this.ondown&&this.ondown(n);break;case"reopen":this.onreopen&&this.onreopen(n);break}return e in this.listeners&&this.listeners[e].slice().forEach(function(s){return o.callListener(s,n)}),!n||!n.defaultPrevented},t.prototype.callListener=function(e,n){typeof e=="function"?e.call(this,n):e.handleEvent.call(this,n)},t.prototype.debugLog=function(e){this.options.debug&&console.log(e)},t.prototype.getTooManyFailedReconnectsMessage=function(){var e=this.options.maxReconnectAttempts;return"Failed to reconnect after "+e+" "+m("attempt",e)+". Closing permanently."},t.DEFAULT_OPTIONS={allClearResetTime:5e3,connectTimeout:5e3,debug:!1,minReconnectDelay:1e3,maxReconnectDelay:3e4,maxReconnectAttempts:Number.POSITIVE_INFINITY,reconnectBackoffFactor:1.5,shouldReconnect:function(){return!0},wsConstructor:void 0},t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t}(),b=l.default=p;function d(t){return typeof t=="string"?2*t.length:t instanceof ArrayBuffer?t.byteLength:t instanceof Blob?t.size:void 0}function m(t,e){return e===1?t:t+"s"}export{b as _};

import"./vue-94711728.js";import{u as Ye}from"./vue-router-7bb53a85.js";import{e as ne,u as z,S as U,a as Qe,G as Ie,m as be,b as Xe,c as H,N as re,d as Oe,f as Ze,_ as ue,g as ke,h as Re,i as $e,j as J,k as Y,R as q,l as te,P as Pe,n as Ge,o as Se,p as et,q as pe,r as ee,s as tt,t as ot,v as st,I as nt,w as at}from"./index-c0670734.js";import{y as G,r as y,o as p,ax as x,bf as u,c as r,V as R,u as c,W as rt,j as b,A as T,b as C,k as me,D as it,G as F,z as _e,t as B,d as Me,$ as lt,g as O,p as fe,O as ct,aQ as dt,n as ut,f as pt,F as ie,i as le,e as K}from"./@vue-19cc1a0c.js";import{x as Q,V as ge}from"./@antv-806868f3.js";import{P as Ne,M as We,n as mt,o as _t,q as Be,i as ft,r as gt,s as ht,F as vt,t as yt,k as bt,u as kt,v as St}from"./@ant-design-3fd71af3.js";import{I as Dt,m as xt,ax as Ve,aw as wt,M as De}from"./ant-design-vue-fc14b735.js";import{s as Ct}from"./@ckpack-f4d25d90.js";import{d as It}from"./pinia-d592fae3.js";import{i as Ae}from"./lodash-7326dc61.js";import{V as Ot}from"./vditor-39a16456.js";import{s as Rt}from"./showdown-d281920d.js";import{u as $t}from"./vue-i18n-df0332b9.js";import"./@web3-onboard-0b8612b3.js";import"./bignumber.js-377fbb8c.js";import"./js-sha3-c0715a7a.js";import"./hash.js-da0ce07b.js";import"./minimalistic-assert-c1ce1705.js";import"./inherits-c31b4f37.js";import"./bn.js-6b0ab283.js";import"./@ethersproject-c84a39ae.js";import"./bech32-9a81277b.js";import"./svelte-i18n-09319bd2.js";import"./svelte-71ed60be.js";import"./deepmerge-84b6eb8e.js";import"./intl-messageformat-1d260046.js";import"./tslib-f4dc1f8d.js";import"./@formatjs-6bc4a248.js";import"./joi-f4dedd38.js";import"./lodash.partition-b22ba0a7.js";import"./@unstoppabledomains-50584184.js";import"./crypto-js-9dcf489b.js";import"./@stablelib-7cabded6.js";import"./cross-fetch-aa52e6a1.js";import"./elliptic-464a2e13.js";import"./minimalistic-crypto-utils-eddaa20e.js";import"./brorand-04b430f9.js";import"./hmac-drbg-0855abe5.js";import"./lodash.merge-c14be068.js";import"./eventemitter3-18427bf7.js";import"./@vueuse-bea165ac.js";import"./lodash.uniqby-0f64a960.js";import"./rxjs-39c6337d.js";import"./bowser-afa341b4.js";import"./@glazed-7e01f8ad.js";import"./dataloader-a32e8ed0.js";import"./@ceramicnetwork-abcc253c.js";import"./caip-9ca4a743.js";import"./uint8arrays-499feafe.js";import"./multiformats-412ad19c.js";import"./@didtools-2547104e.js";import"./@ipld-966a175d.js";import"./cborg-03b6df65.js";import"./apg-js-648c7dea.js";import"./rpc-utils-50b1abf6.js";import"./nanoid-86c80500.js";import"./lru_map-1b96baad.js";import"./varint-034dba75.js";import"./mapmoize-30a3511b.js";import"./lodash.clonedeep-ad7d3f3b.js";import"./did-resolver-55098980.js";import"./multihashes-a1289479.js";import"./multibase-7005923f.js";import"./@multiformats-95f6f35f.js";import"./fast-json-patch-58abc6e9.js";import"./moment-b35f754a.js";import"./vue-demi-fbade89c.js";import"./@ctrl-e5502be2.js";import"./@babel-c07ddd1c.js";import"./lodash-es-47c86505.js";import"./resize-observer-polyfill-f68479a8.js";import"./async-validator-9e2b95c0.js";import"./scroll-into-view-if-needed-90d8f7af.js";import"./compute-scroll-into-view-72df79c3.js";import"./dom-align-de4ed2f2.js";import"./vue-types-932461d1.js";import"./@intlify-a223ad75.js";import"./source-map-46068853.js";const Pt=G({__name:"EdgeSelect",setup(e){return(t,o)=>{const n=y("a-radio-button"),a=y("a-radio-group");return p(),x(a,{value:c(ne),"onUpdate:value":o[0]||(o[0]=s=>rt(ne)?ne.value=s:null),"button-style":"solid"},{default:u(()=>[r(n,{value:"Process"},{default:u(()=>[R("Process")]),_:1}),r(n,{value:"Support"},{default:u(()=>[R("Support")]),_:1})]),_:1},8,["value"])}}});const Gt=G({__name:"Stencil",emits:["openModal"],setup(e,{emit:t}){const{Stencil:o}=Q.exports.Addon,n=b(),{graph:a}=z();return T(()=>{const s=new o({target:a,stencilGraphWidth:100,stencilGraphHeight:300,groups:[{name:"shape",title:"Shape",collapsable:!1},{name:"group",title:"Group",collapsable:!1}],layoutOptions:{columns:1,center:!0,columnWidth:90},getDropNode(d){const{width:f,height:g}=d.size();return d.data&&d.data.parent?d.clone().size(f*4,g*3).setAttrByPath("data/label",{en:"Group"}):d.clone().size(f*2,g*1.5).setAttrByPath("data/label",{en:"Text"})}});n.value?.appendChild(s.container);const i={shape:"rect-shape",width:64,height:35,attrs:{rect:{magnet:!0,rx:5,ry:5,stroke:U,strokeWidth:2}}},_={shape:"rect-shape",width:64,height:35,attrs:{rect:{magnet:!0,rx:5,ry:5,stroke:U,strokeWidth:2},body:{fill:Qe,stroke:U,strokeWidth:1},label:{fill:"#FFF"}}},m={shape:"ellipse-shape",width:64,height:45,attrs:{ellipse:{magnet:!0,stroke:U,strokeWidth:2}}},l={shape:"group-shape",width:64,height:64,attrs:{rect:{magnet:!0,rx:5,ry:5,stroke:Ie,strokeWidth:2}}};s.load([i,_,m],"shape"),s.load([l],"group")}),(s,i)=>(p(),C("div",{className:"app-stencil",ref_key:"stencilContainer",ref:n},null,512))}}),Mt={enabled:!0,width:160,height:120,padding:10,scalable:!1,minScale:.01,maxScale:16,graphOptions:null},Nt=G({name:"MiniMap",props:["enabled","width","height","padding","scalable","minScale","maxScale","graphOptions","createGraph","style"],setup(e){const{graph:t}=z(),o=b(),n=()=>{t.minimap.widget&&t.minimap.widget.dispose()},a=()=>{n();const{enabled:s,...i}=e,_=be(t.options.minimap||{},be({...Mt,graphOptions:{background:t.options.background,grid:t.options.grid}},{...i,enabled:s!==!1,container:o.value}));t.options.minimap=_,t.minimap.widget=t.hook.createMiniMap()};return me(()=>e,()=>a(),{deep:!0}),T(()=>a()),it(()=>n()),()=>{const{style:s={}}=e;return r("div",{ref:i=>o.value=i,style:{position:"absolute",bottom:"16px",left:"16px",background:"transparent",boxShadow:"0px 8px 10px -5px rgba(0,0,0,0.2), 0px 16px 24px 2px rgba(0,0,0,0.14), 0px 6px 30px 5px rgba(0,0,0,0.12)",...s}},null)}}}),Wt={class:"absolute right-4 bottom-4"},Bt=G({__name:"Zoom",setup(e){const{graph:t}=z(),o=t.options.scaling.min||.1,n=t.options.scaling.max||16,a=b(!1),s=b(!1),i=_=>{t.zoom(_);const m=t.zoom();a.value=m>=n,s.value=m<=o};return(_,m)=>{const l=y("a-button");return p(),C("div",Wt,[r(l,{class:"m-2",shape:"circle",onClick:m[0]||(m[0]=d=>i(.2)),disabled:a.value},{icon:u(()=>[r(c(Ne))]),_:1},8,["disabled"]),r(l,{class:"m-2",shape:"circle",onClick:m[1]||(m[1]=d=>i(-.2)),disabled:s.value},{icon:u(()=>[r(c(We))]),_:1},8,["disabled"])])}}}),Vt={key:1,class:"w-full"},he=G({__name:"TextInput",setup(e){const t=Xe(),{getLocale:o}=H(),n=F("getNode",()=>{})(),a=b(!1),s=_e({text:{}}),i=b({color:n.getAttrByPath("label/fill")}),_=()=>{n.setAttrByPath(re,s.text),a.value=!1},m=()=>{a.value=!t.value};return T(()=>{s.text=n.getAttrByPath(re)||{},n.on("changed",l=>{const{options:d}=l;d&&d.propertyPath=="attrs/label/fill"&&(i.value={color:d.propertyValue})})}),(l,d)=>(p(),C("div",{class:"flex items-center w-full p-1 text-base text-center",style:Me(i.value),onDblclick:m},[a.value?(p(),x(c(Dt),{key:0,class:"text-center",value:s.text[c(o)],"onUpdate:value":d[0]||(d[0]=f=>s.text[c(o)]=f),placeholder:s.text[c(o)],onBlur:_},null,8,["value","placeholder"])):(p(),C("p",Vt,B(s.text[c(o)]),1))],36))}}),At={class:"flex flex-col w-full h-full p-2 items-top"},Le=G({__name:"GroupCom",setup(e){return(t,o)=>(p(),C("div",At,[r(he),r(c(xt),{class:"m-0"})]))}}),Lt={class:"flex items-center w-full h-full p-4 text-base text-center"},ve=G({__name:"GeneralCom",setup(e){return(t,o)=>(p(),C("div",Lt,[r(he)]))}}),Et={TEXT_INPUT:"TextInput",GROUP_COM:"GroupCom",GENERAL_COM:"GeneralCom"},Tt=e=>{Q.exports.Graph.registerVueComponent(e,{template:`<${e} />`,components:{TextInput:he,GroupCom:Le,GeneralCom:ve}},!0)};Object.values(Et).map(e=>Tt(e));class Ee extends ge{}class Te extends ge{}class je extends ge{}Ee.config({primer:"rect",attrs:{root:{magnet:!0},body:{fill:Oe,stroke:U,strokeWidth:1}},data:{primer:"rect"},component:{template:"<general-com />",components:{GeneralCom:ve}}});je.config({primer:"ellipse",attrs:{body:{magnet:!0,fill:Oe,stroke:U,strokeWidth:2}},data:{primer:"ellipse"},component:{template:"<general-com />",components:{GeneralCom:ve}}});Te.config({primer:"rect",attrs:{root:{magnet:!0},body:{fill:Ze,stroke:Ie,strokeWidth:1}},data:{primer:"rect",parent:!0},component:{template:"<group-com />",components:{GroupCom:Le}}});Q.exports.Graph.registerNode("rect-shape",Ee);Q.exports.Graph.registerNode("group-shape",Te);Q.exports.Graph.registerNode("ellipse-shape",je);const jt={mode:{type:String,validator:e=>["body","label","stroke"].includes(e)}};const Ft=G({__name:"ColorPicker",props:jt,setup(e){const t=e,{mode:o}=t,n=b("#194D33A8"),a=b({hex8:"#E04343FF"}),s=b(0),{graph:i}=z(),_=l=>o=="stroke"?`${(l.data?l.data.primer:!1)||l.shape}/stroke`:`${o}/fill`;i.on("node:selected",l=>{s.value+=1,s.value==1&&(n.value=l.node.getAttrByPath(_(l.node)))}),i.on("node:unselected",()=>{s.value>0&&(s.value-=1)});const m=()=>{const l=a.value.hex8,d=i.getSelectedCells();n.value=l,d.forEach(f=>{f.isNode()&&f.setAttrByPath(_(f),l)})};return(l,d)=>{const f=y("a-button"),g=y("a-popconfirm");return s.value>0?(p(),x(g,{key:0,placement:"rightTop",onConfirm:m},{icon:u(()=>[]),title:u(()=>[r(c(Ct),{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=$=>a.value=$)},null,8,["modelValue"])]),default:u(()=>[r(f,{type:"primary",style:Me(`background-color: ${n.value}`),shape:"circle",size:"small"},{icon:u(()=>[lt(l.$slots,"default",{},void 0,!0)]),_:3},8,["style"])]),_:3})):O("",!0)}}}),ae=ue(Ft,[["__scopeId","data-v-58187975"]]),V=It({id:"docs",state:()=>({pageLoading:!1,workingDocs:{},stageDocs:{},repoDocs:{},remoteDocs:{}}),getters:{getPageLoading(){return this.pageLoading},getWorkingDocs(){return this.workingDocs},getRemoteDocs(){return this.remoteDocs||{}},getStageDocs(){return ke(this.stageDocs)},getRepoDocs(){return ke(this.repoDocs)}},actions:{setPageLoading(e){this.pageLoading=e},setWorkingDocs(e){this.workingDocs=e},setWorkingDocById(e,t){this.workingDocs[e]=t},delDocById(e){delete this.workingDocs[e]},setRemoteDocById(e,t){this.remoteDocs[e]=t},setStageDoc(e,t){this.setWorkingDocById(e,t),this.stageDocs[e]=t},setRepoDoc(e,t){this.repoDocs[e]=t,this.workingDocs[e]=t},mergerDocs(e){this.repoDocs=e,this.stageDocs={},this.workingDocs={}},recoveryDoc(e){Reflect.deleteProperty(this.workingDocs,e),Reflect.deleteProperty(this.remoteDocs,e)},removeDocs(){this.stageDocs={},this.repoDocs={},this.workingDocs={}}}}),Fe=async(e,t,o,n="")=>{const a=V(),s=Re();return ce(t),Ae(n)||await Ut(e,o,n),s.getAtWork&&(a.getWorkingDocs[o]||ce(t)[o]||Ue(t)[o])||a.getRemoteDocs[o]||{resources:[],progress:0,priority:0,introduction:{},status:0,description:{}}},Ut=async(e,t,o)=>{const{loadTile:n}=$e(e),{content:a}=await n(o),s=V(),i=a;return console.log("useDocs - doc",i),s.setRemoteDocById(t,i),i},zt=e=>ce(e),qt=e=>Ue(e);function ce(e){const t=J({}),o=V(),n=t.getItem(Y,e);return o.getStageDocs||n||{}}function Ue(e){const t=J({}),o=V(),n=t.getItem(q,e);return o.getRepoDocs||n||{}}function Kt(e,t,o){V().setStageDoc(t,o),de(e,t,o,Y)}function Ht(e,t,o){V().setRepoDoc(t,o),de(e,t,o,q),de(e,t,o,Y)}function de(e,t,o,n){const a=J({});let s=a.getItem(n,e)||{};s[t]=o,a.setItem(n,e,s)}function Jt(e){const t=J({});V().removeDocs(),t.removeItem(q,e),t.removeItem(Y,e)}function Yt(e,t,o){Kt(e,t,o)}function xe(e,t,o){Ht(e,t,o)}function Qt(e){Jt(e)}function Xt(e,t){V().mergerDocs(t);const n=J({});Ae(t)?n.removeItem(q,e):n.setItem(q,e,t),n.removeItem(Y,e)}function Zt(e){V().recoveryDoc(e)}const eo=G({inheritAttrs:!1,props:{height:{type:Number,default:360},value:{type:String,default:""}},emits:["change","get","update:value"],setup(e,{attrs:t,emit:o}){const n=b(null),a=b(null),s=b(!1),{getLocale:i}=H(),_=b("");me(()=>e.value,g=>{g!==_.value&&d.getVditor()?.setValue(g),_.value=g});const m=fe(()=>{let g="zh_CN";switch(c(i)){case"en":g="en_US";break;case"ja":g="ja_JP";break;case"ko":g="ko_KR";break;default:g="zh_CN"}return g});function l(){const g=c(n);if(!g)return;const $={...t,...e},w=new Ot(g,{theme:"classic",lang:c(m),mode:"wysiwyg",fullscreen:{index:520},preview:{actions:[]},resize:{enable:!0},toolbar:["emoji","headings","bold","italic","strike","link","|","list","ordered-list","check","outdent","indent","|","quote","line","code","inline-code","insert-before","insert-after","|","table","|","undo","redo","|","fullscreen","edit-mode",{name:"more",toolbar:["both","code-theme","content-theme","export","outline","preview","devtools","help"]}],input:M=>{_.value=M,o("update:value",M),o("change",M)},after:()=>{ut(()=>{w.setValue(_.value),a.value=w,s.value=!0,o("get",d)})},...$,cache:{enable:!1}})}const d={getVditor:()=>a.value};function f(){const g=c(a);if(!!g){try{g?.destroy?.()}catch{}a.value=null,s.value=!1}}return T(()=>{l()}),ct(f),dt(f),{wrapRef:n,...d}}}),to={ref:"wrapRef"};function oo(e,t,o,n,a,s){return p(),C("div",to,null,512)}const so=ue(eo,[["render",oo]]);const no=["innerHTML"],ao=G({__name:"MarkdownViewer",props:{value:{type:String},class:{type:String}},setup(e){const t=e,o=new Rt.Converter;o.setOption("tables",!0);const n=fe(()=>o.makeHtml(t.value||""));return(a,s)=>(p(),C("div",{innerHTML:c(n),class:pt([a.$props.class,"markdown-viewer"])},null,10,no))}}),ro=ue(ao,[["__scopeId","data-v-2a6af044"]]),io=so,lo=ro;const co=G({__name:"Form",props:{nodeId:{type:String,default:""},graphSteamId:{type:String,default:""},docSteamId:{type:String,default:""}},emits:["save"],setup(e,{expose:t,emit:o}){const n=e,{ceramic:a}=F(te),s=b(),i=b(),_=b(),{getLocale:m}=H(),l=_e({node:{stream_id:"",id:"",resources:[],progress:0,priority:0,introduction:{},status:0,description:{}}}),d=async(h,v,j)=>{s.value=h,i.value=v,_.value=j;let P={};P=await Fe(a,v,h,j),P.stream_id=v,P.id=h,l.node={...l.node,...P}},f=h=>{let v=l.node.resources.indexOf(h);v!==-1&&l.node.resources?.splice(v,1)},g=()=>{l.node.resources,l.node.resources.push({title:"",uri:"",id:Date.now()})},$=h=>{l.node.description[m.value]=h,w()},w=()=>{Yt(i.value,s.value,l.node)},M=()=>{xe(i.value,s.value,l.node),o("save")},N=h=>{console.log("Fail",h)},k=()=>{Zt(s.value),d(s.value,i.value,_.value)},D=()=>{xe(i.value,s.value,null),o("save")};return t({initDoc:d}),T(async()=>{await d(n.nodeId,n.graphSteamId,n.docSteamId)}),(h,v)=>{const j=y("a-radio"),P=y("a-radio-group"),S=y("a-form-item"),W=y("a-slider"),A=y("a-rate"),E=y("a-textarea"),L=y("a-input"),X=y("a-space"),oe=y("a-button"),ye=y("a-menu-item"),Ke=y("a-menu"),He=y("a-dropdown"),Je=y("a-form");return p(),x(Je,{class:"max-w-screen-lg m-auto",model:l,onFinish:M,onFinishFailed:N},{default:u(()=>[r(S,{label:"Status"},{default:u(()=>[r(P,{value:l.node.status,"onUpdate:value":v[0]||(v[0]=I=>l.node.status=I)},{default:u(()=>[(p(!0),C(ie,null,le(c(Pe),(I,se)=>(p(),x(j,{value:se},{default:u(()=>[R(B(I),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),r(S,{label:"Progress",rules:[{type:"number",min:0,max:99}]},{default:u(()=>[r(W,{class:"max-w-md",value:l.node.progress,"onUpdate:value":v[1]||(v[1]=I=>l.node.progress=I)},null,8,["value"])]),_:1}),r(S,{label:"Priority"},{default:u(()=>[r(A,{value:l.node.priority,"onUpdate:value":v[2]||(v[2]=I=>l.node.priority=I),disabled:!1},null,8,["value"])]),_:1}),r(S,{label:"Introduction"},{default:u(()=>[r(E,{value:l.node.introduction[c(m)],"onUpdate:value":v[3]||(v[3]=I=>l.node.introduction[c(m)]=I)},null,8,["value"])]),_:1}),r(S,{label:"Description"},{default:u(()=>[r(c(io),{"onUpdate:value":$,value:l.node.description[c(m)]},null,8,["value"])]),_:1}),(p(!0),C(ie,null,le(l.node.resources,(I,se)=>(p(),x(X,{key:I.id,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:u(()=>[r(S,{label:"Title",rules:{required:!0,message:"Missing Title"}},{default:u(()=>[r(L,{value:I.title,"onUpdate:value":Z=>I.title=Z,placeholder:"Description of resources"},null,8,["value","onUpdate:value"])]),_:2},1024),r(S,{label:"Uri",name:["node","resources",se,"uri"],rules:{required:!0,message:"Missing Uri"}},{default:u(()=>[r(L,{value:I.uri,"onUpdate:value":Z=>I.uri=Z,placeholder:"http"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),r(c(mt),{onClick:Z=>f(I)},null,8,["onClick"])]),_:2},1024))),128)),r(S,{class:"mt-4"},{default:u(()=>[r(oe,{type:"dashed",block:"",onClick:g},{default:u(()=>[r(c(Ne)),R(" Add resource ")]),_:1})]),_:1}),r(S,{class:"mb-4 text-right b-button"},{default:u(()=>[r(He,{placement:"top"},{overlay:u(()=>[r(Ke,null,{default:u(()=>[r(ye,{onClick:k},{default:u(()=>[r(c(_t)),R(" Recovery ")]),_:1}),r(ye,{danger:"",onClick:D},{default:u(()=>[r(c(Be)),R(" Delete ")]),_:1})]),_:1})]),default:u(()=>[r(oe,{shape:"circle"},{icon:u(()=>[r(c(ft))]),_:1})]),_:1}),r(oe,{type:"primary","html-type":"submit"},{default:u(()=>[R("Save")]),_:1})]),_:1})]),_:1},8,["model"])}}}),uo={class:"max-w-screen-lg m-auto"},po=K("p",{class:"text-2xl mt-8 font-bold"},"Description",-1),mo=K("p",{class:"text-2xl mt-8 font-bold"},"Resources",-1),_o={class:"list-circle list-inside"},fo=G({__name:"View",props:{nodeId:{type:String,default:""},graphSteamId:{type:String,default:""},docSteamId:{type:String,default:""}},setup(e,{expose:t}){const o=e,{ceramic:n}=F(te),a=b(),{getLocale:s}=H(),i=_e({node:{stream_id:"",id:"",resources:[],progress:0,priority:0,introduction:{},status:0,description:{}}}),_=async(m,l,d)=>{a.value=l,i.node=await Fe(n,m,l,d)};return t({initDoc:_}),T(()=>{_(o.graphSteamId,o.nodeId,o.docSteamId)}),(m,l)=>{const d=y("a-descriptions-item"),f=y("a-progress"),g=y("a-rate"),$=y("a-descriptions"),w=y("a-divider"),M=y("a-empty"),N=y("a-button");return p(),C("div",uo,[r($,{bordered:"",size:"size",column:1},{default:u(()=>[r(d,{label:"Status"},{default:u(()=>[R(B(c(Pe)[i.node.status]),1)]),_:1}),r(d,{label:"Progress"},{default:u(()=>[r(f,{percent:i.node.progress,status:"active"},null,8,["percent"])]),_:1}),r(d,{label:"Priority"},{default:u(()=>[r(g,{value:i.node.priority,disabled:""},null,8,["value"])]),_:1}),r(d,{label:"Introduction"},{default:u(()=>[R(B(i.node.introduction[c(s)]),1)]),_:1})]),_:1}),po,r(w),i.node.description?O("",!0):(p(),x(M,{key:0,description:null})),r(c(lo),{value:i.node.description[c(s)],class:"vditor-reset"},null,8,["value"]),mo,r(w),i.node.resources.length==0?(p(),x(M,{key:1,description:null})):O("",!0),K("ul",null,[(p(!0),C(ie,null,le(i.node.resources,k=>(p(),C("li",_o,[r(N,{href:k.uri,type:"link",target:"_blank",size:"large"},{default:u(()=>[R(B(k.title),1)]),_:2},1032,["href"])]))),256))])])}}});const go=G({__name:"Doc",props:{nodeId:{type:String,default:""},label:{type:String,default:""},graphSteamId:{type:String,default:""},docSteamId:{type:String,default:""}},setup(e,{expose:t}){const o=e,{graph:n}=z(),{isReadOnly:a}=F(Ge),s=b(!1),i=b(),_=()=>{s.value=!0,n.disableMouseWheel()},m=()=>{s.value=!1,n.enableMouseWheel()};return t({showModal:_}),me(()=>[o.nodeId,o.graphSteamId,o.docSteamId],(l,d,f)=>{i.value?.initDoc(l,d,f)}),T(()=>{i.value?.initDoc(o.nodeId,o.graphSteamId,o.docSteamId)}),(l,d)=>{const f=y("a-drawer");return p(),x(f,{title:e.label,placement:"bottom",visible:s.value,onClose:m,height:"100%"},{default:u(()=>[c(a)?(p(),x(fo,{key:1,ref_key:"contentRef",ref:i,"node-id":o.nodeId,"doc-steam-id":o.docSteamId,"graph-steam-id":o.graphSteamId},null,8,["node-id","doc-steam-id","graph-steam-id"])):(p(),x(co,{key:0,ref_key:"contentRef",ref:i,onSave:m,"node-id":o.nodeId,"doc-steam-id":o.docSteamId,"graph-steam-id":o.graphSteamId},null,8,["node-id","doc-steam-id","graph-steam-id"]))]),_:1},8,["title","visible"])}}});function ze(e,t){const o="render";if(e===t)return!0;let n=Object.getOwnPropertyNames(e),a=Object.getOwnPropertyNames(t);if(n.length!==a.length&&!n.includes(o)&&!a.includes(o))return!1;for(const s in e)if(t.hasOwnProperty(s)){if(typeof e[s]=="object"){if(!ze(e[s],t[s]))return!1}else if(e[s]!==t[s])return!1}else if(s!=o)return!1;return!0}const ho=(e={},t={})=>{const o=[],n={},a={};for(const s in e){const i=Object.hasOwnProperty.call(t,s);e[s]?i?i&&t[s]!=e[s]&&(n[s]=e[s]):a[s]=e[s]:i&&o.push(s)}return{deleted:o,updated:n,created:a}},vo=(e=[{}],t={},o="id")=>{const n=Object.keys(t),a={};return e.map(s=>{const i=s[o];n.includes(i)&&(a[i]=t[i])}),a};Ve.config({placement:"topRight",duration:3});function qe(){return{createMessage:wt,notification:Ve}}function we(e,t){return!e||t.startsWith(e)?t:`${e}.${t}`}function yo(e){const t={t:s=>we(e,s)};if(!Se)return t;const{t:o,...n}=Se.global;return{...n,t:(s,...i)=>s?!s.includes(".")&&!e?s:o(we(e,s),...i):""}}async function bo(e,t,o){let n=o.toJSON().cells;const{t:a}=yo(),{addDocs:s,updateDocs:i,deleteDocs:_,updateTile:m}=$e(e),d=et().getRemoteGraph,f=V(),g=Object.assign(qt(t),zt(t),f.getWorkingDocs),$=f.getRemoteDocs,w=vo(n,g),{deleted:M,updated:N,created:k}=ho(w,$);Xt(t,w);const{notification:D}=qe(),{setSpinning:h}=pe(),v=S=>{console.log("err",S),h(!1),D.error({message:a("notification.failed"),description:"",duration:5})};h(!0);let j=4;const P=S=>{j-=1,D.success({message:`${S} ${a("notification.completed")}`,description:"",duration:3}),j<=0&&h(!1)};if(ee(N))P("Docs updated");else{const S=Object.values(N).map(W=>{const A=W;for(let E=0;E<n.length;E++){const L=n[E];if(L.id===A.id)return A.docSteamId=L.data.docSteamId,A}});await i(S).then(()=>{P("Docs updated")}).catch(W=>{v(W)})}if(ee(M))P("Docs deleted");else{const S=Object.values(M);await _(S).then(()=>{P("Docs deleted")}).catch(W=>{v(W)})}if(ee(k))P("Docs Created && Graph updated");else{const S=Object.values(k);await s(S).then(W=>{const A=n;W.forEach(E=>{for(let L=0;L<A.length;L++){const X=A[L];if(X.id===E.id){X.data.docSteamId=E.stream_id;break}}}),n=A}).then(()=>{m(t,Ce(n))}).then(()=>{P("Docs Created && Graph updated")}).catch(W=>{v(W)})}!ze(n,d)&&ee(k)?m(t,Ce(n)).then(()=>{P("Graph updated!")}).catch(S=>{v(S)}):P("Graph updated!")}function Ce(e){return e.map(t=>JSON.stringify(t))}const ko=G({__name:"Edit",props:{graphId:{type:String,required:!0}},setup(e){const t=e,{ceramic:o}=F(te),{t:n}=$t(),a=Re(),{graph:s}=z(),{getIsReadOnly:i}=pe(),_=fe(()=>a.getAtWork),m=()=>{a.setIsReadOnly(!1),a.setAtWork(!0)},l=()=>{a.setIsReadOnly(!0)},d=()=>{a.setIsReadOnly(!1)},f=()=>{a.setIsReadOnly(!0),a.setAtWork(!1)},g=()=>{De.confirm({title:n("editor.release.confirm"),onOk(){console.log("start send!"),bo(o,t.graphId,s)},onCancel(){}})},$=()=>{De.confirm({title:n("editor.emptyDraft.confirm"),okType:"danger",onOk(){Qt(t.graphId),tt(t.graphId),f()},onCancel(){}})};return(w,M)=>{const N=y("a-menu-item"),k=y("a-menu"),D=y("a-dropdown-button");return p(),x(D,null,{overlay:u(()=>[r(k,null,{default:u(()=>[r(N,{key:"1",onClick:g,disabled:!c(_)},{default:u(()=>[r(c(gt)),R(" "+B(w.$t("editor.release.name")),1)]),_:1},8,["disabled"]),r(N,{key:"2",onClick:f,disabled:!c(_)},{default:u(()=>[r(c(ht)),R(" "+B(w.$t("editor.exitEdit")),1)]),_:1},8,["disabled"]),r(N,{danger:"",key:"3",onClick:$},{default:u(()=>[r(c(Be)),R(" "+B(w.$t("editor.emptyDraft.name")),1)]),_:1})]),_:1})]),default:u(()=>[c(_)?O("",!0):(p(),C("div",{key:0,onClick:m},[r(c(vt)),R(" "+B(w.$t("editor.edit")),1)])),!c(i)&&c(_)?(p(),C("div",{key:1,onClick:l},[r(c(yt)),R(" "+B(w.$t("editor.preview")),1)])):O("",!0),c(i)&&c(_)?(p(),C("div",{key:2,onClick:d},[r(c(bt)),R(" "+B(w.$t("editor.exitPreview")),1)])):O("",!0)]),_:1})}}});const So={class:"flex w-full h-full"},Do={key:0},xo={class:"absolute right-5 top-2"},wo={key:1,class:"space-x-2 color-picker-group"},Ys=G({__name:"BaseGraph",setup(e){const t=Ye(),{id:o}=t.currentRoute.value.params,n=b(void 0),a=b(!1),s=b({nodeId:"",label:"",graphSteamId:"",docSteamId:""}),{getLocale:i}=H(),_=b(),{setSpinning:m}=pe(),{ceramic:l}=F(te),{isReadOnly:d,spinning:f,isMember:g}=F(Ge),$=k=>{s.value={nodeId:k.id,label:k.getAttrByPath(re)[i.value]||"",graphSteamId:o,docSteamId:k.data?.docSteamId||""},_.value?.showModal()},w=k=>{k&&typeof o=="string"&&at(o,k,!1)},M=(k,D)=>{D.value?.fromJSON(k),D.value?.centerContent(),D.value?.on("cell:mouseenter",h=>{if(!d.value)if(h.cell.isNode()){const v=h.cell;v.setAttrByPath(`${(v.data?v.data.primer:!1)||v.shape}`,{strokeWidth:8}),h.cell.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-12,y:18}}},{name:"button",args:{markup:{tagName:"circle",selector:"button",attrs:{r:10,stroke:"#fe854f","stroke-width":3,fill:"white",cursor:"pointer"}},x:0,y:"100%",offset:{x:18,y:-25},onClick(){$(h.cell)}}}])}else h.cell.addTools([{name:"button-remove",args:{distance:20}}])}),D.value?.on("cell:mouseleave",h=>{if(h.cell.isNode()){const v=h.cell;v.setAttrByPath(`${(v.data?v.data.primer:!1)||v.shape}`,{strokeWidth:2})}h.cell.removeTools()}),D.value?.on("node:click",h=>{!d.value||$(h.node)}),D.value?.on("cell:changed",()=>{d.value||setTimeout(()=>{w(D.value)},nt)})},N=()=>{const k=ot(n);if(typeof o!="string"||o===""){console.log("id is not string or empty",o),m(!1);return}st(o,l).then(D=>{m(!1),M(D,k)}).then(()=>{a.value=!0}).catch(D=>{m(!1);const{notification:h}=qe();console.log("err",D),h.error({message:"Failed to get data",description:D,duration:3})})};return T(()=>{m(!0),N()}),(k,D)=>{const h=y("a-spin");return p(),C("div",So,[c(d)?O("",!0):(p(),C("div",Do,[r(Gt)])),K("div",{id:"containered",ref_key:"containered",ref:n},null,512),K("div",xo,[a.value&&c(g)?(p(),x(ko,{key:0,"graph-id":c(o)},null,8,["graph-id"])):O("",!0)]),c(d)?O("",!0):(p(),C("div",wo,[r(Pt),a.value?(p(),x(ae,{key:0,mode:"body"},{default:u(()=>[r(c(kt))]),_:1})):O("",!0),a.value?(p(),x(ae,{key:1,mode:"stroke"},{default:u(()=>[r(c(We))]),_:1})):O("",!0),a.value?(p(),x(ae,{key:2,mode:"label"},{default:u(()=>[r(c(St))]),_:1})):O("",!0)])),a.value?(p(),x(Nt,{key:2})):O("",!0),a.value?(p(),x(Bt,{key:3})):O("",!0),a.value?(p(),x(go,{key:4,ref_key:"docRef",ref:_,"node-id":s.value.nodeId,label:s.value.label,graphSteamId:s.value.graphSteamId,docSteamId:s.value.docSteamId},null,8,["node-id","label","graphSteamId","docSteamId"])):O("",!0),c(f)?(p(),x(h,{key:5,class:"absolute flex items-center justify-center w-full h-full bg-gray-500/50 bg-opacity-20",spinning:c(f)},null,8,["spinning"])):O("",!0)])}}});export{Ys as default};

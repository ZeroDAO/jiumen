import"./uint8arrays-1b95a8ae.js";import{c as s,a as u,b as p}from"./@ceramicnetwork-a15705dd.js";import{f}from"./rxjs-39c6337d.js";import"./caip-9ca4a743.js";const E="3id-connect-iframedisplay",A="3id-connect-managedisplay",h=99999,l="position: fixed; width:0; height:0; border:0; border:none !important",_=`border:none; border:0; z-index: ${h-2}; position: fixed; max-width: 100%;`,v=`border:none; border:0; z-index: ${h-1}; position: fixed; width: 100%; height: 100%; top: 0; left: 0;`,y="top: 0px; right: 0px",w="bottom: 0px; left: 0px;",P=t=>()=>t.style=l,I=t=>(e=!1,n="245px",r="440px")=>{t.style=`${_} width: ${r}; height: ${n}; ${e?w:y}`};function b(t){const e=I(t),n=P(t);return s(E,{hide:()=>{n()},display:(r,{mobile:a,height:c,width:i})=>{e(a,c,i)}})}const S=t=>{const e=document.createElement("iframe");return e.name="threeid-connect",e.className="threeid-connect",e.src=t,e.style=l,e.allowTransparency=!0,e.frameBorder=0,e};function M(t){let e;return s(A,{display:async(n,{accountId:r})=>{e=R(`${t}?accountId=${r}`),document.body.appendChild(e),await new Promise(i=>{e.onload=i});const a=u(window),c=i=>i.data.ns==="3id-connect-management";await a.pipe(f(c)).toPromise(),e.remove()}})}const R=t=>{const e=document.createElement("iframe");return e.name="threeid-connect-manage",e.className="threeid-connect-manage",e.src=t,e.allowtransparency=!1,e.style=v,e};let m="3id-connect-authprovider";typeof process<"u"&&(m={}.NAMESPACE||"3id-connect-authprovider");function g(t,e=m){return s(e,{accountId:async()=>(await t.accountId()).toString(),authenticate:async(n,{message:r})=>await t.authenticate(r),createLink:async(n,{did:r})=>await t.createLink(r)})}const L=["dev-unstable","testnet-clay","mainnet","local"],o="v2",T=`https://app-dev.3idconnect.org/${o}`,C=`https://app-clay.3idconnect.org/${o}`,N=`https://app.3idconnect.org/${o}`,D=`http://localhost:30001/${o}`,$="/management.html",x="/index.html",F={"dev-unstable":T,"testnet-clay":C,mainnet:N,local:D},U=t=>`${t}${$}`,O=t=>`${t}${x}`,d=t=>F[t],B=t=>L.includes(t),W="3id-connect-did-provider";class Y{get isDidProvider(){return!0}async send(e){return this._client.connection.send(e)}constructor(e,n=W){this._client=p(n,e)}}const H="testnet-clay",G=()=>{if(typeof window>"u"||typeof document>"u")throw new Error("ThreeIdConnect not supported in this enviroment")};class q{async connect(e){this._authProviderSubscription&&this._authProviderSubscription.unsubscribe(),e&&await this.setAuthProvider(e),await this.iframeLoadedPromise,this._authProviderSubscription=g(e).subscribe(),b(this.iframe).subscribe(),M(this.manageUrl).subscribe(),this._connected=!0}async setAuthProvider(e){this.authProvider=e,this.accountId=(await this.authProvider.accountId()).toString()}get connected(){return this._connected}getDidProvider(){if(!this.authProvider)throw new Error("setAuthProvider required");if(!this.iframe.contentWindow)throw new Error("3id connect iframe service not found");return new Y(this.iframe.contentWindow)}constructor(e){this._authProviderSubscription=null,this._connected=!1,G();const n=B(e||"")?d(e):e||d(H);this.iframe=S(O(n)),this.manageUrl=U(n),this.iframeLoadedPromise=new Promise(r=>{this.iframe.onload=()=>{r()}}),document.body.appendChild(this.iframe)}}export{q as T};

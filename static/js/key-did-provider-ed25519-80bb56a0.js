import{e as y}from"./@stablelib-91de8d10.js";import{x as h,d as l,E as w,a as f}from"./did-jwt-7d41a1a2.js";import{f as g}from"./fast-json-stable-stringify-ec71e3ec.js";import{t as p}from"./uint8arrays-1b95a8ae.js";import{c as S,a as c}from"./rpc-utils-50b1abf6.js";const D="base64pad";function i(t){return JSON.parse(g(t))}function b(t){const e=new Uint8Array(t.length+2);return e[0]=237,e[1]=1,e.set(t,2),`did:key:z${p(e,"base58btc")}`}function d(t){const[e,r,n]=t.split(".");return{payload:r,signatures:[{protected:e,signature:n}]}}const u=async(t,e,r,n={})=>{const s=`${e}#${e.split(":")[2]}`,o=w(r),a=i(Object.assign(n,{kid:s,alg:"EdDSA"}));return f(typeof t=="string"?t:i(t),o,a)},m={did_authenticate:async({did:t,secretKey:e},r)=>{const n=await u({did:t,aud:r.aud,nonce:r.nonce,paths:r.paths,exp:Math.floor(Date.now()/1e3)+600},t,e);return d(n)},did_createJWS:async({did:t,secretKey:e},r)=>{if(r.did.split("#")[0]!==t)throw new c(4100,`Unknown DID: ${t}`);const s=await u(r.payload,t,e,r.protected);return{jws:d(s)}},did_decryptJWE:async({secretKey:t},e)=>{const r=h(y.convertSecretKeyToX25519(t));try{const n=await l(e.jwe,r);return{cleartext:p(n,D)}}catch(n){throw new c(-32e3,n.message)}}};class _{constructor(e){const{secretKey:r,publicKey:n}=y.generateKeyPairFromSeed(e),s=b(n),o=S(m);this._handle=async a=>await o({did:s,secretKey:r},a)}get isDidProvider(){return!0}async send(e){return await this._handle(e)}}export{_ as E};

const ye=["string","number","bigint","symbol"],ge=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function we(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";const n=typeof e;if(ye.includes(n))return n;if(n==="function")return"Function";if(Array.isArray(e))return"Array";if(me(e))return"Buffer";const t=pe(e);return t||"Object"}function me(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function pe(e){const n=Object.prototype.toString.call(e).slice(8,-1);if(ge.includes(n))return n}class o{constructor(n,t,r){this.major=n,this.majorEncoded=n<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(n){return this.major<n.major?-1:this.major>n.major?1:0}}o.uint=new o(0,"uint",!0);o.negint=new o(1,"negint",!0);o.bytes=new o(2,"bytes",!0);o.string=new o(3,"string",!0);o.array=new o(4,"array",!1);o.map=new o(5,"map",!1);o.tag=new o(6,"tag",!1);o.float=new o(7,"float",!0);o.false=new o(7,"false",!0);o.true=new o(7,"true",!0);o.null=new o(7,"null",!0);o.undefined=new o(7,"undefined",!0);o.break=new o(7,"break",!0);class s{constructor(n,t,r){this.type=n,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const I=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",_e=new TextDecoder,ke=new TextEncoder;function j(e){return I&&globalThis.Buffer.isBuffer(e)}function oe(e){return e instanceof Uint8Array?j(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const Ee=I?(e,n,t)=>t-n>64?globalThis.Buffer.from(e.subarray(n,t)).toString("utf8"):te(e,n,t):(e,n,t)=>t-n>64?_e.decode(e.subarray(n,t)):te(e,n,t),be=I?e=>e.length>64?globalThis.Buffer.from(e):ne(e):e=>e.length>64?ke.encode(e):ne(e),k=e=>Uint8Array.from(e),q=I?(e,n,t)=>j(e)?new Uint8Array(e.subarray(n,t)):e.slice(n,t):(e,n,t)=>e.slice(n,t),Be=I?(e,n)=>(e=e.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),oe(globalThis.Buffer.concat(e,n))):(e,n)=>{const t=new Uint8Array(n);let r=0;for(let i of e)r+i.length>t.length&&(i=i.subarray(0,t.length-r)),t.set(i,r),r+=i.length;return t},Te=I?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Ae(e,n){if(j(e)&&j(n))return e.compare(n);for(let t=0;t<e.length;t++)if(e[t]!==n[t])return e[t]<n[t]?-1:1;return 0}function ne(e,n=1/0){let t;const r=e.length;let i=null;const u=[];for(let a=0;a<r;++a){if(t=e.charCodeAt(a),t>55295&&t<57344){if(!i){if(t>56319){(n-=3)>-1&&u.push(239,191,189);continue}else if(a+1===r){(n-=3)>-1&&u.push(239,191,189);continue}i=t;continue}if(t<56320){(n-=3)>-1&&u.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(n-=3)>-1&&u.push(239,191,189);if(i=null,t<128){if((n-=1)<0)break;u.push(t)}else if(t<2048){if((n-=2)<0)break;u.push(t>>6|192,t&63|128)}else if(t<65536){if((n-=3)<0)break;u.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((n-=4)<0)break;u.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return u}function te(e,n,t){const r=[];for(;n<t;){const i=e[n];let u=null,a=i>239?4:i>223?3:i>191?2:1;if(n+a<=t){let d,y,B,g;switch(a){case 1:i<128&&(u=i);break;case 2:d=e[n+1],(d&192)===128&&(g=(i&31)<<6|d&63,g>127&&(u=g));break;case 3:d=e[n+1],y=e[n+2],(d&192)===128&&(y&192)===128&&(g=(i&15)<<12|(d&63)<<6|y&63,g>2047&&(g<55296||g>57343)&&(u=g));break;case 4:d=e[n+1],y=e[n+2],B=e[n+3],(d&192)===128&&(y&192)===128&&(B&192)===128&&(g=(i&15)<<18|(d&63)<<12|(y&63)<<6|B&63,g>65535&&g<1114112&&(u=g))}}u===null?(u=65533,a=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|u&1023),r.push(u),n+=a}return Se(r)}const re=4096;function Se(e){const n=e.length;if(n<=re)return String.fromCharCode.apply(String,e);let t="",r=0;for(;r<n;)t+=String.fromCharCode.apply(String,e.slice(r,r+=re));return t}const $e=256;class ie{constructor(n=$e){this.chunkSize=n,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(n){let t=this.chunks[this.chunks.length-1];if(this.cursor+n.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(n,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}n.length<64&&n.length<this.chunkSize?(t=Te(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(n,0)):(this.chunks.push(n),this.maxCursor+=n.length)}this.cursor+=n.length}toBytes(n=!1){let t;if(this.chunks.length===1){const r=this.chunks[0];n&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=q(r,0,this.cursor)}else t=Be(this.chunks,this.cursor);return n&&this.reset(),t}}const f="CBOR decode error:",ue="CBOR encode error:";function U(e,n,t){if(e.length-n<t)throw new Error(`${f} not enough data for type`)}const h=[24,256,65536,4294967296,BigInt("18446744073709551616")];function T(e,n,t){U(e,n,1);const r=e[n];if(t.strict===!0&&r<h[0])throw new Error(`${f} integer encoded in more bytes than necessary (strict decode)`);return r}function A(e,n,t){U(e,n,2);const r=e[n]<<8|e[n+1];if(t.strict===!0&&r<h[1])throw new Error(`${f} integer encoded in more bytes than necessary (strict decode)`);return r}function S(e,n,t){U(e,n,4);const r=e[n]*16777216+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];if(t.strict===!0&&r<h[2])throw new Error(`${f} integer encoded in more bytes than necessary (strict decode)`);return r}function $(e,n,t){U(e,n,8);const r=e[n]*16777216+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],i=e[n+4]*16777216+(e[n+5]<<16)+(e[n+6]<<8)+e[n+7],u=(BigInt(r)<<BigInt(32))+BigInt(i);if(t.strict===!0&&u<h[3])throw new Error(`${f} integer encoded in more bytes than necessary (strict decode)`);if(u<=Number.MAX_SAFE_INTEGER)return Number(u);if(t.allowBigInt===!0)return u;throw new Error(`${f} integers outside of the safe integer range are not supported`)}function Ne(e,n,t,r){return new s(o.uint,T(e,n+1,r),2)}function Ie(e,n,t,r){return new s(o.uint,A(e,n+1,r),3)}function Ue(e,n,t,r){return new s(o.uint,S(e,n+1,r),5)}function ve(e,n,t,r){return new s(o.uint,$(e,n+1,r),9)}function N(e,n){return m(e,0,n.value)}function m(e,n,t){if(t<h[0]){const r=Number(t);e.push([n|r])}else if(t<h[1]){const r=Number(t);e.push([n|24,r])}else if(t<h[2]){const r=Number(t);e.push([n|25,r>>>8,r&255])}else if(t<h[3]){const r=Number(t);e.push([n|26,r>>>24&255,r>>>16&255,r>>>8&255,r&255])}else{const r=BigInt(t);if(r<h[4]){const i=[n|27,0,0,0,0,0,0,0];let u=Number(r&BigInt(4294967295)),a=Number(r>>BigInt(32)&BigInt(4294967295));i[8]=u&255,u=u>>8,i[7]=u&255,u=u>>8,i[6]=u&255,u=u>>8,i[5]=u&255,i[4]=a&255,a=a>>8,i[3]=a&255,a=a>>8,i[2]=a&255,a=a>>8,i[1]=a&255,e.push(i)}else throw new Error(`${f} encountered BigInt larger than allowable range`)}}N.encodedSize=function(n){return m.encodedSize(n.value)};m.encodedSize=function(n){return n<h[0]?1:n<h[1]?2:n<h[2]?3:n<h[3]?5:9};N.compareTokens=function(n,t){return n.value<t.value?-1:n.value>t.value?1:0};function Ce(e,n,t,r){return new s(o.negint,-1-T(e,n+1,r),2)}function Me(e,n,t,r){return new s(o.negint,-1-A(e,n+1,r),3)}function ze(e,n,t,r){return new s(o.negint,-1-S(e,n+1,r),5)}const K=BigInt(-1),ce=BigInt(1);function xe(e,n,t,r){const i=$(e,n+1,r);if(typeof i!="bigint"){const u=-1-i;if(u>=Number.MIN_SAFE_INTEGER)return new s(o.negint,u,9)}if(r.allowBigInt!==!0)throw new Error(`${f} integers outside of the safe integer range are not supported`);return new s(o.negint,K-BigInt(i),9)}function W(e,n){const t=n.value,r=typeof t=="bigint"?t*K-ce:t*-1-1;m(e,n.type.majorEncoded,r)}W.encodedSize=function(n){const t=n.value,r=typeof t=="bigint"?t*K-ce:t*-1-1;return r<h[0]?1:r<h[1]?2:r<h[2]?3:r<h[3]?5:9};W.compareTokens=function(n,t){return n.value<t.value?1:n.value>t.value?-1:0};function x(e,n,t,r){U(e,n,t+r);const i=q(e,n+t,n+t+r);return new s(o.bytes,i,t+r)}function Fe(e,n,t,r){return x(e,n,1,t)}function Oe(e,n,t,r){return x(e,n,2,T(e,n+1,r))}function je(e,n,t,r){return x(e,n,3,A(e,n+1,r))}function Re(e,n,t,r){return x(e,n,5,S(e,n+1,r))}function De(e,n,t,r){const i=$(e,n+1,r);if(typeof i=="bigint")throw new Error(`${f} 64-bit integer bytes lengths not supported`);return x(e,n,9,i)}function R(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===o.string?be(e.value):e.value),e.encodedBytes}function L(e,n){const t=R(n);m(e,n.type.majorEncoded,t.length),e.push(t)}L.encodedSize=function(n){const t=R(n);return m.encodedSize(t.length)+t.length};L.compareTokens=function(n,t){return Le(R(n),R(t))};function Le(e,n){return e.length<n.length?-1:e.length>n.length?1:Ae(e,n)}function F(e,n,t,r,i){const u=t+r;U(e,n,u);const a=new s(o.string,Ee(e,n+t,n+u),u);return i.retainStringBytes===!0&&(a.byteValue=q(e,n+t,n+u)),a}function Ve(e,n,t,r){return F(e,n,1,t,r)}function Ge(e,n,t,r){return F(e,n,2,T(e,n+1,r),r)}function Pe(e,n,t,r){return F(e,n,3,A(e,n+1,r),r)}function qe(e,n,t,r){return F(e,n,5,S(e,n+1,r),r)}function Ke(e,n,t,r){const i=$(e,n+1,r);if(typeof i=="bigint")throw new Error(`${f} 64-bit integer string lengths not supported`);return F(e,n,9,i,r)}const We=L;function v(e,n,t,r){return new s(o.array,r,t)}function He(e,n,t,r){return v(e,n,1,t)}function Xe(e,n,t,r){return v(e,n,2,T(e,n+1,r))}function Je(e,n,t,r){return v(e,n,3,A(e,n+1,r))}function Qe(e,n,t,r){return v(e,n,5,S(e,n+1,r))}function Ye(e,n,t,r){const i=$(e,n+1,r);if(typeof i=="bigint")throw new Error(`${f} 64-bit integer array lengths not supported`);return v(e,n,9,i)}function Ze(e,n,t,r){if(r.allowIndefinite===!1)throw new Error(`${f} indefinite length items not allowed`);return v(e,n,1,1/0)}function H(e,n){m(e,o.array.majorEncoded,n.value)}H.compareTokens=N.compareTokens;H.encodedSize=function(n){return m.encodedSize(n.value)};function C(e,n,t,r){return new s(o.map,r,t)}function en(e,n,t,r){return C(e,n,1,t)}function nn(e,n,t,r){return C(e,n,2,T(e,n+1,r))}function tn(e,n,t,r){return C(e,n,3,A(e,n+1,r))}function rn(e,n,t,r){return C(e,n,5,S(e,n+1,r))}function on(e,n,t,r){const i=$(e,n+1,r);if(typeof i=="bigint")throw new Error(`${f} 64-bit integer map lengths not supported`);return C(e,n,9,i)}function un(e,n,t,r){if(r.allowIndefinite===!1)throw new Error(`${f} indefinite length items not allowed`);return C(e,n,1,1/0)}function X(e,n){m(e,o.map.majorEncoded,n.value)}X.compareTokens=N.compareTokens;X.encodedSize=function(n){return m.encodedSize(n.value)};function cn(e,n,t,r){return new s(o.tag,t,1)}function sn(e,n,t,r){return new s(o.tag,T(e,n+1,r),2)}function an(e,n,t,r){return new s(o.tag,A(e,n+1,r),3)}function fn(e,n,t,r){return new s(o.tag,S(e,n+1,r),5)}function ln(e,n,t,r){return new s(o.tag,$(e,n+1,r),9)}function J(e,n){m(e,o.tag.majorEncoded,n.value)}J.compareTokens=N.compareTokens;J.encodedSize=function(n){return m.encodedSize(n.value)};const dn=20,hn=21,yn=22,gn=23;function wn(e,n,t,r){if(r.allowUndefined===!1)throw new Error(`${f} undefined values are not supported`);return r.coerceUndefinedToNull===!0?new s(o.null,null,1):new s(o.undefined,void 0,1)}function mn(e,n,t,r){if(r.allowIndefinite===!1)throw new Error(`${f} indefinite length items not allowed`);return new s(o.break,void 0,1)}function Q(e,n,t){if(t){if(t.allowNaN===!1&&Number.isNaN(e))throw new Error(`${f} NaN values are not supported`);if(t.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${f} Infinity values are not supported`)}return new s(o.float,e,n)}function pn(e,n,t,r){return Q(Z(e,n+1),3,r)}function _n(e,n,t,r){return Q(ee(e,n+1),5,r)}function kn(e,n,t,r){return Q(le(e,n+1),9,r)}function Y(e,n,t){const r=n.value;if(r===!1)e.push([o.float.majorEncoded|dn]);else if(r===!0)e.push([o.float.majorEncoded|hn]);else if(r===null)e.push([o.float.majorEncoded|yn]);else if(r===void 0)e.push([o.float.majorEncoded|gn]);else{let i,u=!1;(!t||t.float64!==!0)&&(ae(r),i=Z(p,1),r===i||Number.isNaN(r)?(p[0]=249,e.push(p.slice(0,3)),u=!0):(fe(r),i=ee(p,1),r===i&&(p[0]=250,e.push(p.slice(0,5)),u=!0))),u||(En(r),i=le(p,1),p[0]=251,e.push(p.slice(0,9)))}}Y.encodedSize=function(n,t){const r=n.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!t||t.float64!==!0){ae(r);let i=Z(p,1);if(r===i||Number.isNaN(r))return 3;if(fe(r),i=ee(p,1),r===i)return 5}return 9};const se=new ArrayBuffer(9),w=new DataView(se,1),p=new Uint8Array(se,0);function ae(e){if(e===1/0)w.setUint16(0,31744,!1);else if(e===-1/0)w.setUint16(0,64512,!1);else if(Number.isNaN(e))w.setUint16(0,32256,!1);else{w.setFloat32(0,e);const n=w.getUint32(0),t=(n&2139095040)>>23,r=n&8388607;if(t===255)w.setUint16(0,31744,!1);else if(t===0)w.setUint16(0,(e&2147483648)>>16|r>>13,!1);else{const i=t-127;i<-24?w.setUint16(0,0):i<-14?w.setUint16(0,(n&2147483648)>>16|1<<24+i,!1):w.setUint16(0,(n&2147483648)>>16|i+15<<10|r>>13,!1)}}}function Z(e,n){if(e.length-n<2)throw new Error(`${f} not enough data for float16`);const t=(e[n]<<8)+e[n+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const r=t>>10&31,i=t&1023;let u;return r===0?u=i*2**-24:r!==31?u=(i+1024)*2**(r-25):u=i===0?1/0:NaN,t&32768?-u:u}function fe(e){w.setFloat32(0,e,!1)}function ee(e,n){if(e.length-n<4)throw new Error(`${f} not enough data for float32`);const t=(e.byteOffset||0)+n;return new DataView(e.buffer,t,4).getFloat32(0,!1)}function En(e){w.setFloat64(0,e,!1)}function le(e,n){if(e.length-n<8)throw new Error(`${f} not enough data for float64`);const t=(e.byteOffset||0)+n;return new DataView(e.buffer,t,8).getFloat64(0,!1)}Y.compareTokens=N.compareTokens;function l(e,n,t){throw new Error(`${f} encountered invalid minor (${t}) for major ${e[n]>>>5}`)}function V(e){return()=>{throw new Error(`${f} ${e}`)}}const c=[];for(let e=0;e<=23;e++)c[e]=l;c[24]=Ne;c[25]=Ie;c[26]=Ue;c[27]=ve;c[28]=l;c[29]=l;c[30]=l;c[31]=l;for(let e=32;e<=55;e++)c[e]=l;c[56]=Ce;c[57]=Me;c[58]=ze;c[59]=xe;c[60]=l;c[61]=l;c[62]=l;c[63]=l;for(let e=64;e<=87;e++)c[e]=Fe;c[88]=Oe;c[89]=je;c[90]=Re;c[91]=De;c[92]=l;c[93]=l;c[94]=l;c[95]=V("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)c[e]=Ve;c[120]=Ge;c[121]=Pe;c[122]=qe;c[123]=Ke;c[124]=l;c[125]=l;c[126]=l;c[127]=V("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)c[e]=He;c[152]=Xe;c[153]=Je;c[154]=Qe;c[155]=Ye;c[156]=l;c[157]=l;c[158]=l;c[159]=Ze;for(let e=160;e<=183;e++)c[e]=en;c[184]=nn;c[185]=tn;c[186]=rn;c[187]=on;c[188]=l;c[189]=l;c[190]=l;c[191]=un;for(let e=192;e<=215;e++)c[e]=cn;c[216]=sn;c[217]=an;c[218]=fn;c[219]=ln;c[220]=l;c[221]=l;c[222]=l;c[223]=l;for(let e=224;e<=243;e++)c[e]=V("simple values are not supported");c[244]=l;c[245]=l;c[246]=l;c[247]=wn;c[248]=V("simple values are not supported");c[249]=pn;c[250]=_n;c[251]=kn;c[252]=l;c[253]=l;c[254]=l;c[255]=mn;const _=[];for(let e=0;e<24;e++)_[e]=new s(o.uint,e,1);for(let e=-1;e>=-24;e--)_[31-e]=new s(o.negint,e,1);_[64]=new s(o.bytes,new Uint8Array(0),1);_[96]=new s(o.string,"",1);_[128]=new s(o.array,0,1);_[160]=new s(o.map,0,1);_[244]=new s(o.false,!1,1);_[245]=new s(o.true,!0,1);_[246]=new s(o.null,null,1);function bn(e){switch(e.type){case o.false:return k([244]);case o.true:return k([245]);case o.null:return k([246]);case o.bytes:return e.value.length?void 0:k([64]);case o.string:return e.value===""?k([96]):void 0;case o.array:return e.value===0?k([128]):void 0;case o.map:return e.value===0?k([160]):void 0;case o.uint:return e.value<24?k([Number(e.value)]):void 0;case o.negint:if(e.value>=-24)return k([31-Number(e.value)])}}const Bn={float64:!1,mapSorter:Sn,quickEncodeToken:bn};function Tn(){const e=[];return e[o.uint.major]=N,e[o.negint.major]=W,e[o.bytes.major]=L,e[o.string.major]=We,e[o.array.major]=H,e[o.map.major]=X,e[o.tag.major]=J,e[o.float.major]=Y,e}const de=Tn(),P=new ie;class D{constructor(n,t){this.obj=n,this.parent=t}includes(n){let t=this;do if(t.obj===n)return!0;while(t=t.parent);return!1}static createCheck(n,t){if(n&&n.includes(t))throw new Error(`${ue} object contains circular references`);return new D(t,n)}}const E={null:new s(o.null,null),undefined:new s(o.undefined,void 0),true:new s(o.true,!0),false:new s(o.false,!1),emptyArray:new s(o.array,0),emptyMap:new s(o.map,0)},b={number(e,n,t,r){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new s(o.float,e):e>=0?new s(o.uint,e):new s(o.negint,e)},bigint(e,n,t,r){return e>=BigInt(0)?new s(o.uint,e):new s(o.negint,e)},Uint8Array(e,n,t,r){return new s(o.bytes,e)},string(e,n,t,r){return new s(o.string,e)},boolean(e,n,t,r){return e?E.true:E.false},null(e,n,t,r){return E.null},undefined(e,n,t,r){return E.undefined},ArrayBuffer(e,n,t,r){return new s(o.bytes,new Uint8Array(e))},DataView(e,n,t,r){return new s(o.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,n,t,r){if(!e.length)return t.addBreakTokens===!0?[E.emptyArray,new s(o.break)]:E.emptyArray;r=D.createCheck(r,e);const i=[];let u=0;for(const a of e)i[u++]=O(a,t,r);return t.addBreakTokens?[new s(o.array,e.length),i,new s(o.break)]:[new s(o.array,e.length),i]},Object(e,n,t,r){const i=n!=="Object",u=i?e.keys():Object.keys(e),a=i?e.size:u.length;if(!a)return t.addBreakTokens===!0?[E.emptyMap,new s(o.break)]:E.emptyMap;r=D.createCheck(r,e);const d=[];let y=0;for(const B of u)d[y++]=[O(B,t,r),O(i?e.get(B):e[B],t,r)];return An(d,t),t.addBreakTokens?[new s(o.map,a),d,new s(o.break)]:[new s(o.map,a),d]}};b.Map=b.Object;b.Buffer=b.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))b[`${e}Array`]=b.DataView;function O(e,n={},t){const r=we(e),i=n&&n.typeEncoders&&n.typeEncoders[r]||b[r];if(typeof i=="function"){const a=i(e,r,n,t);if(a!=null)return a}const u=b[r];if(!u)throw new Error(`${ue} unsupported type: ${r}`);return u(e,r,n,t)}function An(e,n){n.mapSorter&&e.sort(n.mapSorter)}function Sn(e,n){const t=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(n[0])?n[0][0]:n[0];if(t.type!==r.type)return t.type.compare(r.type);const i=t.type.major,u=de[i].compareTokens(t,r);return u===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),u}function he(e,n,t,r){if(Array.isArray(n))for(const i of n)he(e,i,t,r);else t[n.type.major](e,n,r)}function $n(e,n,t){const r=O(e,t);if(!Array.isArray(r)&&t.quickEncodeToken){const i=t.quickEncodeToken(r);if(i)return i;const u=n[r.type.major];if(u.encodedSize){const a=u.encodedSize(r,t),d=new ie(a);if(u(d,r,t),d.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return oe(d.chunks[0])}}return P.reset(),he(P,r,n,t),P.toBytes(!0)}function Cn(e,n){return n=Object.assign({},Bn,n),$n(e,de,n)}const Nn={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class In{constructor(n,t={}){this.pos=0,this.data=n,this.options=t}done(){return this.pos>=this.data.length}next(){const n=this.data[this.pos];let t=_[n];if(t===void 0){const r=c[n];if(!r)throw new Error(`${f} no decoder for major type ${n>>>5} (byte 0x${n.toString(16).padStart(2,"0")})`);const i=n&31;t=r(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}}const M=Symbol.for("DONE"),G=Symbol.for("BREAK");function Un(e,n,t){const r=[];for(let i=0;i<e.value;i++){const u=z(n,t);if(u===G){if(e.value===1/0)break;throw new Error(`${f} got unexpected break to lengthed array`)}if(u===M)throw new Error(`${f} found array but not enough entries (got ${i}, expected ${e.value})`);r[i]=u}return r}function vn(e,n,t){const r=t.useMaps===!0,i=r?void 0:{},u=r?new Map:void 0;for(let a=0;a<e.value;a++){const d=z(n,t);if(d===G){if(e.value===1/0)break;throw new Error(`${f} got unexpected break to lengthed map`)}if(d===M)throw new Error(`${f} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(r!==!0&&typeof d!="string")throw new Error(`${f} non-string keys not supported (got ${typeof d})`);if(t.rejectDuplicateMapKeys===!0&&(r&&u.has(d)||!r&&d in i))throw new Error(`${f} found repeat map key "${d}"`);const y=z(n,t);if(y===M)throw new Error(`${f} found map but not enough entries (got ${a} [no value], expected ${e.value})`);r?u.set(d,y):i[d]=y}return r?u:i}function z(e,n){if(e.done())return M;const t=e.next();if(t.type===o.break)return G;if(t.type.terminal)return t.value;if(t.type===o.array)return Un(t,e,n);if(t.type===o.map)return vn(t,e,n);if(t.type===o.tag){if(n.tags&&typeof n.tags[t.value]=="function"){const r=z(e,n);return n.tags[t.value](r)}throw new Error(`${f} tag not supported (${t.value})`)}throw new Error("unsupported")}function Mn(e,n){if(!(e instanceof Uint8Array))throw new Error(`${f} data to decode must be a Uint8Array`);n=Object.assign({},Nn,n);const t=n.tokenizer||new In(e,n),r=z(t,n);if(r===M)throw new Error(`${f} did not find any content to decode`);if(r===G)throw new Error(`${f} got unexpected break`);if(!t.done())throw new Error(`${f} too many terminals, data makes no sense`);return r}export{s as T,o as a,Mn as d,Cn as e};
